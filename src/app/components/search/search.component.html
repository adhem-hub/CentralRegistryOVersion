<!-- Updated Search Section -->
<div *ngIf="isLoggedIn" class="searchemployee-container">
  <!-- Search Container -->
  <div class="searchemployee-container !max-w-[1180px] w-full mx-auto">
    <div
      class="searchemployee-box bg-white shadow-lg rounded-lg p-8 max-w-full mx-auto"
    >
    
      <!-- Tabs and Advanced Search Toggle -->
      <div
        class="flex flex-wrap md:flex-nowrap justify-between items-center gap-4 border-b pb-3 w-full"
      >
        <!-- Left Side: Search + Toggle -->
        <div class="flex items-center gap-4 flex-wrap sm:flex-nowrap min-w-0">
          <!-- Search for Companies -->
          <div
            class="tab text-base sm:text-lg font-semibold cursor-pointer whitespace-nowrap"
            [class.active]="activeTab === 'companies'"
            (click)="activeTab = 'companies'"
            translate="search.companies"
          ></div>

          <!-- Advanced Search Toggle -->
          <div
            class="flex items-center -mt-2"
            *ngIf="activeTab === 'companies'"
          >
            <label
              for="advancedSearch"
              class="flex items-center cursor-pointer whitespace-nowrap"
            >
              <span
                class="text-gray-500 text-base sm:text-lg"
                translate="search.advancedSearch"
              ></span>
              <div class="relative ml-2">
                <input
                  type="checkbox"
                  id="advancedSearch"
                  [(ngModel)]="advancedSearch"
                  (change)="advancedSearchToggle()"
                  class="sr-only"
                />
                <div
                  class="toggle-line block w-14 h-7 bg-gray-300 rounded-full transition-all duration-300"
                  [class.bg-[#085E5A]]="advancedSearch"
                ></div>
                <div
                  class="toggle-dot absolute top-1 left-1 w-5 h-5 bg-white rounded-full transition-all duration-300"
                  [class.translate-x-7]="advancedSearch"
                ></div>
              </div>
            </label>
          </div>
        </div>

        <!-- Center: My Companies -->
        <div class="flex justify-center">
          <div
            class="tab text-base sm:text-lg cursor-pointer whitespace-nowrap"
            [class.active]="activeTab === 'myCompanies'"
            (click)="activeTab = 'myCompanies'"
            translate="search.myCompanies"
          ></div>
        </div>

        <!-- Right Side: Contact or Add Company Button -->
        <div class="flex items-center gap-4">
          <!-- Add Company Button -->
          <div
            *ngIf="activeTab === 'myCompanies' && (companies ?? []).length > 0"
          >
            <button
              (click)="addCompany()"
              class="bg-[#085E5A] text-white px-4 py-2 rounded-md hover:bg-[#064A47] w-full md:w-auto"
            >
              {{ "addCompanies" | translate }}
            </button>
          </div>

          <!-- Contact Tab (only shown when not on myCompanies tab) -->
          <div
            *ngIf="activeTab !== 'myCompanies'"
            class="tab text-base sm:text-lg cursor-pointer whitespace-nowrap"
            [class.active]="activeTab === 'contact'"
            (click)="activeTab = 'contact'"
            translate="search.aboutus"
          ></div>
        </div>
      </div>

      <!-- Search Companies Section (Simple Search Form) -->
      <div class="py-6" *ngIf="activeTab === 'companies' && !advancedSearch">
        <h1 class="text-3xl font-bold" translate="search.companyNameOrUID"></h1>
        <p class="text-gray-500 text-lg" translate="search.whatsTheUID"></p>
        <div class="flex items-center mt-6 relative">
          <div class="relative w-full">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="onInputChange($event)"
              (keydown)="onKeyDown($event)"
              (focus)="onInputFocus()"
              (blur)="onInputBlur()"
              [placeholder]="'search.enterCompanyNameOrUID' | translate"
              class="search-input p-3 w-full text-lg rounded-lg border border-gray-300"
              autocomplete="off"
            />

            <!-- Autocomplete Dropdown -->
            <div
              *ngIf="
                showAutocompleteSuggestions &&
                autocompleteSuggestions.length > 0
              "
              class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto"
            >
              <div
                *ngFor="
                  let suggestion of autocompleteSuggestions;
                  let i = index
                "
                class="p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0"
                [class.bg-blue-50]="i === selectedSuggestionIndex"
                (mousedown)="selectSuggestion(suggestion)"
                (mouseenter)="selectedSuggestionIndex = i"
              >
                <div class="font-medium text-gray-900">
                  {{ suggestion.name }}
                </div>
                <div
                  class="text-sm text-gray-600"
                  *ngIf="suggestion.unique_identifier"
                >
                  {{'ID' | translate }}: {{ suggestion.unique_identifier }}
                </div>
              </div>
            </div>
          </div>

          <button
            (click)="onSearch()"
            class="search-button bg-[#085E5A] text-white px-6 py-3 ml-4 rounded-lg shadow-md hover:bg-[#064E4B] text-xl"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 21l-4.35-4.35m2.85-6.65a8 8 0 11-16 0 8 8 0 0116 0z"
              />
            </svg>
          </button>
        </div>
        <!-- Error Message -->
        <p *ngIf="errorMessage" class="text-red-500 mt-2">{{ errorMessage }}</p>

        <br />
        <!-- Default Companies Table 
                <div class="table-container" *ngIf="!isSearchClicked ">
                    <div class="overflow-x-auto mt-0 !w-[1200px] !max-w-none mx-auto rounded-lg shadow">
                        <table class="w-full text-sm text-left text-black dark:text-black rounded-lg overflow-hidden">
                            <caption class="p-5 text-lg font-semibold text-left text-gray-900 bg-white rounded-t-lg">
                                {{ 'RESULTS_COUNT' | translate }}: {{ companiess.length }}
                            </caption>
                            <thead
                                class="text-xs text-black rounded-lg uppercase bg-gray-50 dark:bg-gray-700 dark:text-black">
                                <tr>
                                    <th scope="col" class="px-6 py-3">{{ 'COMPANY_NAME' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'UID' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'LOCATION' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'legal_form' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'LEGAL_STATUS' | translate }}</th>
                                    <th scope="col" class="px-6 py-3 text-right">{{ 'ACTIONS' | translate }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let company of companiess"
                                    class="bg-white border-b dark:bg-white dark:border-gray-200 last:rounded-b-lg">
                                    <td class="px-6 py-4 font-medium text-black whitespace-nowrap dark:text-black cursor-pointer hover:underline"
                                        (click)="viewCompanyDetailss(company.id)">
                                        {{ company.name }}
                                    </td>
                                    <td class="px-6 py-4">{{ company.unique_identifier }}</td>
                                    <td class="px-6 py-4">{{ company.headquarters }} {{ company.location }} {{
                                        company.country }}</td>
                                    <td class="px-6 py-4">
                                        {{ getLegalFormName(company.legal_information.legal_forms) }}
                                    </td>
                                    <td class="px-6 py-4">{{ getTranslatedStatus(company.legal_information.legal_status)
                                        }}</td>
                                    <td class="px-6 py-4 text-right">
                                        <a (click)="generatePDF(company.id)" download="report.pdf"
                                            class="font-medium text-blue-600 dark:text-blue-500 hover:underline">PDF</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br>
                  
                </div>
                <div *ngIf="companiess.length === 0" class="text-center text-gray-500 mt-4">
                    {{ 'NO_COMPANIES_FOUND' | translate }}
                </div>
-->
        <!-- Search Results Table (Now in Same Width as Search Section) -->
        <div
          *ngIf="isSearchClicked && !showVerticalTable"
          class="table-container"
        >
        <div
        *ngIf="searchResults.length > 0"
       
      >
      <app-search-results-grid
        [searchResults]="searchResults"
        [searchTotalItems]="searchTotalItems"
        [getLegalFormName]="getLegalFormName.bind(this)"
        [getTranslatedStatus]="getTranslatedStatus.bind(this)"
        (companySelected)="viewCompanyDetailss($event)"
        (pdfGenerated)="generatePDF($event)">
      </app-search-results-grid>
      </div>
          <!-- <div
            *ngIf="searchResults.length > 0"
            class="overflow-x-auto mt-0 !w-[1200px] !max-w-none mx-auto rounded-lg overflow-hidden"
          >
            <div class="overflow-hidden rounded-lg shadow">
              <table
                class="w-full text-sm text-left text-black dark:text-black"
              >
                <caption
                  class="p-5 text-lg font-semibold text-left text-gray-900 bg-white"
                >
                  {{
                    "RESULTS_COUNT" | translate
                  }}:
                  {{
                    searchTotalItems
                  }}
                </caption>
                
                <thead
                  class="text-xs text-black uppercase bg-gray-50 dark:bg-gray-700 dark:text-black"
                >
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      {{ "Logo" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "COMPANY_NAME" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "UID" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LOCATION" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "legal_form" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LEGAL_STATUS" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3 text-right">
                      {{ "ACTIONS" | translate }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let company of searchResults"
                    class="bg-white border-b last:rounded-b-lg dark:bg-white dark:border-gray-700"
                  >
                  <td>
                    <img src="{{ company.logo_url }}" class="h-10 w-10 " *ngIf="company?.logo_url"  />
                  </td>
                    <td
                      class="px-6 py-4 font-medium tracking-widest text-black whitespace-nowrap dark:text-black cursor-pointer hover:underline"
                      (click)="viewCompanyDetailss(company.id)"
                    >
                      {{ company.name }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.unique_identifier }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.headquarters }} {{ company.location }}
                    
                          {{ ("COUNTRIES." + company.country.toUpperCase()) | translate }}

                        
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{
                        getLegalFormName(company.legal_information.legal_forms)
                      }}
                    </td>
                    <td class="px-6 py-4">
                      {{
                        getTranslatedStatus(
                          company.legal_information.legal_status
                        )
                      }}
                    </td>
                    <td class="px-6 py-4 text-right">
                      <a
                        (click)="generatePDF(company.id)"
                        download="report.pdf"
                        class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                        >PDF</a
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div> -->
          <br />
          <div
            *ngIf="searchResults.length === 0"
            class="text-center text-gray-500 mt-4"
          >
            {{ "NO_RESULTS" | translate }}
          </div>

          <app-search-results-grid
            [searchResults]="searchResults"
            [searchTotalItems]="searchTotalItems"
            [getLegalFormName]="getLegalFormName.bind(this)"
            [getTranslatedStatus]="getTranslatedStatus.bind(this)"
            (companySelected)="viewCompanyDetailss($event)"
            (pdfGenerated)="generatePDF($event)">
          </app-search-results-grid>
        </div>

        <!-- Search Results Pagination Controls -->
        <div
          class="flex flex-col sm:flex-row justify-center items-center mt-6 gap-4"
          *ngIf="(isSearchClicked || isSearchClickede) && searchTotalPages > 1"
        >
          <!-- Pagination Navigation -->
          <div class="flex items-center space-x-2">
            <!-- First Page -->
            <button
              (click)="goToSearchFirstPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'FIRST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Previous Page -->
            <button
              (click)="goToSearchPreviousPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'PREVIOUS_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Page Numbers -->
            <div class="flex space-x-1">
              <button
                *ngFor="let pageNum of searchPageNumbers"
                (click)="goToSearchPage(pageNum)"
                [class]="
                  searchCurrentPage === pageNum
                    ? 'px-3 py-2 text-sm bg-[#085E5A] text-white rounded-md'
                    : 'px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50'
                "
              >
                {{ pageNum }}
              </button>
            </div>

            <!-- Next Page -->
            <button
              (click)="goToSearchNextPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'NEXT_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>

            <!-- Last Page -->
            <button
              (click)="goToSearchLastPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'LAST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 5l7 7-7 7M5 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Search Results Summary (when no pagination needed) -->
        <div
          class="flex justify-between items-center mt-4"
          *ngIf="
            (isSearchClicked || isSearchClickede) &&
            searchTotalPages <= 1 &&
            searchResults.length > 0
          "
        >
        <!-- toedit -->
          <div class="text-sm text-gray-600">
            {{ "TOTAL" | translate }}: {{ searchTotalItems }}
            {{ "ITEMS" | translate }}
          </div>
        </div>

        <!-- Compact Vertical Company Info View -->
        <div
          *ngIf="
            isSearchClicked && showVerticalTable && searchResults.length === 1
          "
          class="w-full bg-white rounded shadow-sm text-sm ml-4"
        >
          <div
            class="border-b px-4 py-3"
            *ngFor="let company of searchResults"
            (click)="viewCompanyDetailss(company.id)"
          >
            <!-- Top Row: Name + File Icon -->
            <!-- <div class="flex justify-between items-center">
              <h1
                class="text-2xl text-blue-600 hover:underline cursor-pointer text-right"
              >
                {{ company.name }}
              </h1>
            </div> -->
            <div class="flex items-center space-x-3">
                          
              <div class="h-14 w-14 rounded-lg overflow-hidden bg-gray-100 border border-gray-200 flex-shrink-0">
                <img 
                  [src]="searchResults[0].logo_url" 
                  [alt]="searchResults[0].name + ' logo'"
                  class="h-full w-full object-cover"
                  *ngIf="searchResults[0]?.logo_url"
                />
                <div  
                  class="h-full w-full flex items-center justify-center text-blue-700 text-xl font-medium"
                  *ngIf="!searchResults[0]?.logo_url"
                >
                  {{ searchResults[0].name?.charAt(0)?.toUpperCase() }}
                </div>
              </div>
              <div>
                <h1
                    class="text-xl text-blue-700 font-medium hover:underline cursor-pointer "
                  >
                    {{ company.name }}
                </h1>
                <span class="text-sm text-gray-500 mt-1">
                  {{ searchResults[0].unique_identifier }}
                </span>
              </div>
            </div>
          </div>

          <div class="divide-y">
            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ADDRESS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].headquarters }}
                {{ searchResults[0].location }}
              </div>
            </div>

            <!-- <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "BRANCH_LOCATION" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ getBranchLocationNames(searchResults[0].branch_locations) }}
              </div>
            </div> -->

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "PROJECT_ACTIVITY" | translate }}
              </div>
              
              <!-- Desktop version with tooltip -->
              <div class="hidden tablet:block">
                <div
                  class="text-gray-800 text-right"
                  [matTooltip]="searchResults[0].activity?.details"
                  matTooltipPosition="above"
                  matTooltipClass="custom-tooltip"
                >
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 30 }}
                </div>
              </div>
              
              <!-- Mobile version with view more button -->
              <div class="block tablet:hidden text-right">
                <div class="text-gray-800">
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 20 }}
                </div>
                <button 
                  *ngIf="searchResults[0].activity?.details && (searchResults[0].activity?.details).length > 20"
                  (click)="openActivityDetailsModal()"
                  class="text-blue-600 text-xs mt-1 underline hover:text-blue-800"
                >
                  {{ "VIEW_MORE" | translate }}
                </button>
              </div>
            </div>
            
            <!-- Activity Details Modal -->
            <div
              *ngIf="showActivityDetailsModal"
              class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
              (click)="closeActivityDetailsModal()"
            >
              <div
                class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-hidden"
                (click)="$event.stopPropagation()"
              >
                <!-- Header -->
                <div class="bg-[#085E5A] px-4 py-3 text-white">
                  <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">{{ "PROJECT_ACTIVITY" | translate }}</h3>
                    <button 
                      (click)="closeActivityDetailsModal()"
                      class="text-white hover:text-gray-200"
                    >
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Content -->
                <div class="p-4 overflow-y-auto max-h-[60vh]">
                  <div class="mb-3" *ngIf="searchResults[0].activity?.project_name">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "PROJECT_NAME" | translate }}</h4>
                    <p class="text-gray-700">{{ searchResults[0].activity?.project_name }}</p>
                  </div>
                  
                  <div *ngIf="searchResults[0].activity?.details">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "DETAILS" | translate }}</h4>
                    <p class="text-gray-700 leading-relaxed">{{ searchResults[0].activity?.details }}</p>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="px-4 py-3 border-t border-gray-200">
                  <button
                    (click)="closeActivityDetailsModal()"
                    class="w-full bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064540] transition-colors"
                  >
                    {{ "CLOSE" | translate }}
                  </button>
                </div>
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "COUNTRY" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ ("COUNTRIES." + searchResults[0].country.toUpperCase()) | translate }}

              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "LEGAL_FORM" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getLegalFormName(
                    searchResults[0].legal_information.legal_forms
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "STATUS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getTranslatedStatus(
                    searchResults[0].legal_information.legal_status
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "UID" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].unique_identifier }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ACTIONS" | translate }}
              </div>
              <div
                class="space-x-2 text-right"
                *ngFor="let company of searchResults"
              >
                <a
                  (click)="generatePDF(company.id)"
                  class="text-blue-600 hover:underline cursor-pointer"
                  >{{ "pdf" | translate }}</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ViewCompanysearch -->
      <div
        *ngIf="isAnotherSectionVisible"
        class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"
      >
          <app-company-details-modal
                [company]="selectedCompany"
                [searchResults]="searchResults"
                [languageCodeToKey]="languageCodeToKey"
                [currentLanguage]="currentLanguage"
                (closeModal)="closeisCompanyDetailsVisible2()"
          ></app-company-details-modal>
        
      </div>
      <!-- Advanced Search Section -->
       <!-- toedit -->
      <div class="py-6" *ngIf="activeTab === 'companies' && advancedSearch">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-6">
          <div class="col-span-2">
            <label
              class="block text-lg font-medium text-gray-700"
              translate="search.companyNameOrUID"
            ></label>
            <div class="relative">
              <!-- toedit3 -->
              <input
                type="text"
                [(ngModel)]="searchQuery"
                (input)="onAdvancedInputChange($event)"
                (keydown)="onAdvancedKeyDown($event)"
                (focus)="onAdvancedInputFocus()"
                (blur)="onAdvancedInputBlur()"
                [placeholder]="'search.companyNameOrUID' | translate"
                class="advanced-search-input p-3 w-full text-lg rounded-lg border border-gray-300"
                autocomplete="off"
              />

              <div
                *ngIf="
                  showAdvancedAutocompleteSuggestions &&
                  advancedAutocompleteSuggestions.length > 0
                "
                class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto"
              >
                <div
                  *ngFor="
                    let suggestion of advancedAutocompleteSuggestions;
                    let i = index
                  "
                  class="p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0"
                  [class.bg-blue-50]="i === selectedAdvancedSuggestionIndex"
                  (mousedown)="selectAdvancedSuggestion(suggestion)"
                  (mouseenter)="selectedAdvancedSuggestionIndex = i"
                >
                  <div class="font-medium text-gray-900">
                    {{ suggestion.name }}
                  </div>
                  <div
                    class="text-sm text-gray-600"
                    *ngIf="suggestion.unique_identifier"
                  >
                    {{'ID' | translate }}: {{ suggestion.unique_identifier }}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Error Message -->
          <p *ngIf="errorMessage" class="text-red-500 mt-2">
            {{ errorMessage }}
          </p>

          <div class="col-span-2">
            <label
              class="block text-lg font-medium text-gray-700"
              translate="search.location"
            ></label>
            <ng-select
              class="advanced-search-input p-3 w-full text-lg rounded-lg border border-gray-300 bg-gray-100 ng-placeholder-light"
              [items]="filteredRegions"
              bindLabel="displayLabel"
              [multiple]="true"
              [(ngModel)]="selectedRegions"
              [placeholder]="
                currentSearchTerm && currentSearchTerm.length > 0
                  ? ''
                  : ('search.select.region' | translate)
              "
              (search)="onRegionSearch($event)"
              [addTag]="customAddTag"
              [addTagText]="'search.add.region' | translate"
              [notFoundText]="
                currentSearchTerm && currentSearchTerm.length > 0
                  ? ('no.items.found' | translate)
                  : ''
              "
              (add)="onCustomRegionAdd($event)"
            >
            </ng-select>
          </div>

          <div class="flex flex-col">
            <!-- Canton Selection
                        <div class="form-group w-full md:w-1/2 lg:w-full">
                            <label class="form-label">{{ 'Canton' | translate }}</label>
                            <mat-form-field appearance="outline" class="custom-selectt w-full">
                                <mat-select [(ngModel)]="selectedKantons" multiple panelClass="kanton-dropdown"
                                    [placeholder]="'SELECT_CANTON' | translate">
                                    <mat-option *ngFor="let kanton of kantons" [value]="kanton.code">
                                        <div class="kanton-item">
                                            <span class="kanton-code">{{ kanton.code }}</span>
                                            <span class="kanton-name">{{ kanton.name }}</span>
                                        </div>
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <br> -->
            <!-- Legal Form Selection -->
            <!-- Legal Form Selection -->
            <div class="form-group w-full md:w-1/2 lg:w-full">
              <label class="form-label">{{ "Legal Form" | translate }}</label>
              <div class="relative w-full">
                <select
                  [(ngModel)]="legal_forms"
                  class="appearance-none w-full p-2 border-b border-gray-300 text-base text-gray-400 focus:ring-0 focus:border-[#085E5A]"
                >
                  <option value="" disabled selected class="text-gray-400">
                    {{ "Select a legal form" | translate }}
                  </option>
                  <option
                    *ngFor="let form of legalFormsList"
                    [value]="form.value"
                  >
                    {{ form.key | translate }}
                  </option>
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="col-span-2 flex justify-center space-x-4">
            <button
              (click)="resetFields()"
              class="reset-button bg-gray-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-gray-600 text-xl flex items-center gap-2"
            >
              {{ "search.reset" | translate }}
            </button>

            <button
              (click)="onSsearch()"
              class="search-button bg-[#085E5A] text-white px-6 py-3 rounded-lg shadow-md hover:bg-[#064A47] text-xl flex items-center gap-2"
            >
              {{ "search.search" | translate }}
            </button>
          </div>
        </div>
        <br />

        <!-- Search Results Table (Now in Same Width as Search Section) -->
        <!-- Ensure table is shown only if search clicked and results exist -->
        <div
          *ngIf="isSearchClickede && !showVerticalTable"
          class="table-container"
        >
          <!-- If there are results, show them in the horizontal table -->
           <!-- todo2 -->
           <div
           *ngIf="searchResults.length > 0 && !showVerticalTable"
          
         >
         <app-search-results-grid
           [searchResults]="searchResults"
           [searchTotalItems]="searchTotalItems"
           [getLegalFormName]="getLegalFormName.bind(this)"
           [getTranslatedStatus]="getTranslatedStatus.bind(this)"
           (companySelected)="viewCompanyDetailss($event)"
           (pdfGenerated)="generatePDF($event)">
         </app-search-results-grid>
         </div>
          <!-- <div
            *ngIf="searchResults.length > 0 && !showVerticalTable"
            class="overflow-x-auto mt-0 !w-[1200px] !max-w-none mx-auto rounded-lg overflow-hidden"
          >
            <div class="overflow-hidden rounded-lg shadow">
              <table
                class="w-full text-sm text-left text-black dark:text-black"
              >
                <caption
                  class="p-5 text-lg font-semibold text-left text-gray-900 bg-white"
                >
                  {{
                    "RESULTS_COUNT" | translate
                  }}:
                  {{
                    searchTotalItems
                  }}
                </caption>
                
                <thead
                  class="text-xs text-black uppercase bg-gray-50 dark:bg-gray-700 dark:text-black"
                >
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      {{ "Logo" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "COMPANY_NAME" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "UID" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LOCATION" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "legal_form" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LEGAL_STATUS" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3 text-right">
                      {{ "ACTIONS" | translate }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let company of searchResults"
                    class="bg-white border-b last:rounded-b-lg dark:bg-white dark:border-gray-700"
                  >
                  <td class="p-3 " style="border: none">
                    <img src="{{ company.logo_url }}" class="h-20 w-20 " *ngIf="company?.logo_url"  />
                  </td>
                    <td
                      class="px-6 py-4 font-medium tracking-widest text-black whitespace-nowrap dark:text-black cursor-pointer hover:underline"
                      (click)="viewCompanyDetailss(company.id)"
                    >
                      {{ company.name }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.unique_identifier }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.headquarters }} {{ company.location }}
                     
                          {{ ("COUNTRIES." + company.country.toUpperCase()) | translate }}

                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{
                        getLegalFormName(company.legal_information.legal_forms)
                      }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{
                        getTranslatedStatus(
                          company.legal_information.legal_status
                        )
                      }}
                    </td>
                    <td class="px-6 py-4 text-right">
                      <a
                        (click)="generatePDF(company.id)"
                        download="report.pdf"
                        class="font-medium text-blue-600 dark:text-blue-500 hover:underline"
                        >PDF</a
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
              <div
                *ngIf="searchResults.length === 0"
                class="text-center text-gray-500 mt-4"
              >
                {{ "NO_RESULTS" | translate }}
              </div>
            </div>
          </div> -->

          <!-- If no results, display a message -->
          <div
            *ngIf="searchResults.length === 0 && !showVerticalTable"
            class="text-center text-gray-500 mt-4"
          >
            {{ "NO_RESULTS" | translate }}
          </div>
        </div>

        <!-- Search Results Pagination Controls -->
        <div
          class="flex flex-col sm:flex-row justify-center items-center mt-6 gap-4"
          *ngIf="(isSearchClicked || isSearchClickede) && searchTotalPages > 1"
        >
          <!-- Pagination Navigation -->
          <div class="flex items-center space-x-2">
            <!-- First Page -->
            <button
              (click)="goToSearchFirstPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'FIRST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Previous Page -->
            <button
              (click)="goToSearchPreviousPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'PREVIOUS_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Page Numbers -->
            <div class="flex space-x-1">
              <button
                *ngFor="let pageNum of searchPageNumbers"
                (click)="goToSearchPage(pageNum)"
                [class]="
                  searchCurrentPage === pageNum
                    ? 'px-3 py-2 text-sm bg-[#085E5A] text-white rounded-md'
                    : 'px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50'
                "
              >
                {{ pageNum }}
              </button>
            </div>

            <!-- Next Page -->
            <button
              (click)="goToSearchNextPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'NEXT_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>

            <!-- Last Page -->
            <button
              (click)="goToSearchLastPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'LAST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 5l7 7-7 7M5 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Search Results Summary (when no pagination needed) -->
         <!-- toedit2 -->
        <div
          class="flex justify-between items-center mt-4"
          *ngIf="
            (isSearchClicked || isSearchClickede) &&
            searchTotalPages <= 1 &&
            searchResults.length > 0
          "
        >
          <div class="text-sm text-gray-600">
            {{ "TOTAL" | translate }}: {{ searchTotalItems }}
            {{ "ITEMS" | translate }}
          </div>
        </div>

        <!-- Compact Vertical Company Info View -->
        <div
          *ngIf="
            isSearchClickede && showVerticalTable && searchResults.length === 1
          "
          class="w-full bg-white rounded shadow-sm text-sm ml-4"
        >
          <div
            class="border-b px-4 py-3"
            *ngFor="let company of searchResults"
            (click)="viewCompanyDetailss(company.id)"
          >
            <!-- Top Row: Name + File Icon -->
            <!-- <div class="flex justify-between items-center">
              <h1
                class="text-2xl text-blue-600 hover:underline cursor-pointer text-right"
              >
                {{ company.name }}
              </h1>
            </div> -->

            <div class="flex items-center space-x-3">
                          
              <div class="h-14 w-14 rounded-lg overflow-hidden bg-gray-100 border border-gray-200 flex-shrink-0">
                <img 
                  [src]="searchResults[0].logo_url" 
                  [alt]="searchResults[0].name + ' logo'"
                  class="h-full w-full object-cover"
                  *ngIf="searchResults[0]?.logo_url"
                />
                <div  
                  class="h-full w-full flex items-center justify-center text-blue-700 text-xl font-medium"
                  *ngIf="!searchResults[0]?.logo_url"
                >
                  {{ searchResults[0].name?.charAt(0)?.toUpperCase() }}
                </div>
              </div>
              <div>
                <h1
                    class="text-xl text-blue-700 font-medium hover:underline cursor-pointer"
                  >
                    {{ company.name }}
                </h1>
                <span class="text-sm text-gray-500 mt-1">
                  {{ searchResults[0].unique_identifier }}
                </span>
              </div>
            </div>
            
          </div>

          <div class="divide-y">
            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ADDRESS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].headquarters }}
                {{ searchResults[0].location }}
              </div>
            </div>

            <!-- <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "BRANCH_LOCATION" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ getBranchLocationNames(searchResults[0].branch_locations) }}
              </div>
            </div> -->

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "PROJECT_ACTIVITY" | translate }}
              </div>
              
              <!-- Desktop version with tooltip -->
              <div class="hidden tablet:block">
                <div
                  class="text-gray-800 text-right"
                  [matTooltip]="searchResults[0].activity?.details"
                  matTooltipPosition="above"
                  matTooltipClass="custom-tooltip"
                >
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 30 }}
                </div>
              </div>
              
              <!-- Mobile version with view more button -->
              <div class="block tablet:hidden text-right">
                <div class="text-gray-800">
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 20 }}
                </div>
                <button 
                  *ngIf="searchResults[0].activity?.details && (searchResults[0].activity?.details).length > 20"
                  (click)="openActivityDetailsModal()"
                  class="text-blue-600 text-xs mt-1 underline hover:text-blue-800"
                >
                  {{ "VIEW_MORE" | translate }}
                </button>
              </div>
            </div>
            
            <!-- Activity Details Modal -->
            <div
              *ngIf="showActivityDetailsModal"
              class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
              (click)="closeActivityDetailsModal()"
            >
              <div
                class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-hidden"
                (click)="$event.stopPropagation()"
              >
                <!-- Header -->
                <div class="bg-[#085E5A] px-4 py-3 text-white">
                  <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">{{ "PROJECT_ACTIVITY" | translate }}</h3>
                    <button 
                      (click)="closeActivityDetailsModal()"
                      class="text-white hover:text-gray-200"
                    >
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Content -->
                <div class="p-4 overflow-y-auto max-h-[60vh]">
                  <div class="mb-3" *ngIf="searchResults[0].activity?.project_name">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "PROJECT_NAME" | translate }}</h4>
                    <p class="text-gray-700">{{ searchResults[0].activity?.project_name }}</p>
                  </div>
                  
                  <div *ngIf="searchResults[0].activity?.details">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "DETAILS" | translate }}</h4>
                    <p class="text-gray-700 leading-relaxed">{{ searchResults[0].activity?.details }}</p>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="px-4 py-3 border-t border-gray-200">
                  <button
                    (click)="closeActivityDetailsModal()"
                    class="w-full bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064540] transition-colors"
                  >
                    {{ "CLOSE" | translate }}
                  </button>
                </div>
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "COUNTRY" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                <!-- {{ searchResults[0].country }} -->
                {{ ("COUNTRIES." + searchResults[0].country.toUpperCase()) | translate }}

              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "LEGAL_FORM" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getLegalFormName(
                    searchResults[0].legal_information.legal_forms
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "STATUS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getTranslatedStatus(
                    searchResults[0].legal_information.legal_status
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "UID" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].unique_identifier }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ACTIONS" | translate }}
              </div>
              <div
                class="space-x-2 text-right"
                *ngFor="let company of searchResults"
              >
                <a
                  (click)="generatePDF(company.id)"
                  class="text-blue-600 hover:underline cursor-pointer"
                  >{{ "pdf" | translate }}</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- My Companies Section -->

      <!-- My Companies Section -->
      <div class="py-6" *ngIf="activeTab === 'myCompanies'">
        <div *ngIf="isTableVisible && (companies ?? []).length > 0">
          <!-- Items per page selector and info -->
          <div
            class="flex flex-col sm:flex-row justify-end items-end sm:items-center mb-4 gap-4"
          >
            <!-- <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">{{ 'ITEMS_PER_PAGE' | translate }}:</label>
            <select
              [(ngModel)]="itemsPerPage"
              (change)="onItemsPerPageChange()"
              class="border border-gray-300 rounded px-2 py-1 text-sm"
            >
              <option *ngFor="let option of itemsPerPageOptions" [value]="option">
                {{ option }}
              </option>
            </select>
          </div> -->

            <div class="text-sm text-gray-600">
              {{ "SHOWING" | translate }} {{ currentPageInfo }}
              {{ "ITEMS" | translate }}
            </div>
          </div>

          <!-- Table -->
          <div class="overflow-x-auto">
           
            <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden">
              <thead class="bg-gray-700">
                <tr class="border-t">
                  <!-- <th class="py-3 px-4 text-leftfont-medium">
                    {{ "Logo" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left  font-medium">
                    {{ "companyName" | translate }}
                  </th> -->
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "companyName" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "uid" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "legalForm" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "location" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "status" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "Approvalstatus" | translate }}
                  </th>
                  <th class="py-3 px-4 text-left text-gray-600">
                    {{ "action" | translate }}
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr *ngFor="let company of companies" class="hover:bg-gray-50 transition-colors">
                  <!-- <td class="py-3 px-4">
                    <div class="flex items-center">
                     
                    </div>
                  </td> -->
                  <!-- <td class="py-4 px-4">
                    <div class="flex items-center justify-center">
                      <img 
                        [src]="company.logo_url" 
                        [alt]="company.name + ' logo'"
                        class="h-12 w-12 rounded-full object-cover border-2 border-gray-200 shadow-sm"
                        *ngIf="company?.logo_url"
                      />
                      <div 
                        class="h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-semibold"
                        *ngIf="!company?.logo_url"
                      >
                        {{ company.name?.charAt(0)?.toUpperCase() }}
                      </div>
                    </div>
                  </td> -->
                  <!-- <td class="py-4 px-4 items-center">
                    {{ company.name }}
                  </td> -->
                  <td class="py-4 px-4">
                    <div class="flex items-center space-x-3">
                      
                      <div class="h-10 w-10 rounded-lg overflow-hidden bg-gray-100 border border-gray-200 flex-shrink-0">
                        <img 
                          [src]="company.logo_url" 
                          [alt]="company.name + ' logo'"
                          class="h-full w-full object-cover"
                          *ngIf="company?.logo_url"
                        />
                        <div 
                          class="h-full w-full flex items-center justify-center text-gray-500 text-sm font-medium"
                          *ngIf="!company?.logo_url"
                        >
                          {{ company.name?.charAt(0)?.toUpperCase() }}
                        </div>
                      </div>
                      <div>
                        <div class="text-sm font-medium text-gray-900">{{ company.name }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="py-4 px-4">{{ company.unique_identifier }}</td>
                  <td class="px-6 py-4">
                    {{
                      getLegalFormName(company.legal_information.legal_forms)
                    }}
                  </td>
                  <td class="py-4 px-4">{{ company.location }}</td>
                  <td class="px-6 py-4">
                    {{
                      getTranslatedStatus(
                        company.legal_information.legal_status
                      )
                    }}
                  </td>
                  <td class="py-4 px-4">
                    <span
                      [ngClass]="{
                        'bg-green-600': company.approval_status === 'accepted',
                        'bg-red-600': company.approval_status === 'rejected',
                        'bg-yellow-400': company.approval_status === 'pending'
                      }"
                      class="text-white px-3 py-1 rounded-full text-sm"
                    >
                      {{
                        "APPROVAL_STATUSE." +
                          company.approval_status.toUpperCase() | translate
                      }}
                    </span>
                  </td>
                  <td class="py-4 px-4 flex space-x-2">
                    <!-- Edit Button -->
                    <button
                      (click)="getCompanyDetails(company.id)"
                      class="p-2 bg-white hover:bg-white rounded-lg"
                    >
                      <svg
                        class="w-6 h-6"
                        style="color: #085e5a"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M10.779 17.779 4.36 19.918 6.5 13.5m4.279 4.279 8.364-8.643a3.027 3.027 0 0 0-2.14-5.165 3.03 3.03 0 0 0-2.14.886L6.5 13.5m4.279 4.279L6.499 13.5m2.14 2.14 6.213-6.504M12.75 7.04 17 11.28"
                        />
                      </svg>
                    </button>

                    <!-- View Button -->
                    <button
                      (click)="viewCompanyDetails(company.id)"
                      class="p-2 bg-white hover:bg-gray-100 rounded-lg"
                    >
                      <svg
                        class="w-6 h-6"
                        style="color: #085e5a"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 3a4 4 0 1 1 0 8 4 4 0 0 1 0-8z"
                        />
                      </svg>
                    </button>

                    <!-- Delete Button -->
                    <button
                      (click)="
                        openModal({ name: company.name, id: company.id })
                      "
                      class="p-2 bg-white hover:bg-gray-100 rounded-lg"
                    >
                      <svg
                        class="w-6 h-6 text-[#085E5A]"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z"
                        />
                      </svg>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- ViewCompany -->
            <div
              *ngIf="isCompanyDetailsVisible"
              class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"
            >
            <app-company-details-modal
                [company]="selectedCompany"
                [searchResults]="searchResults"
                [languageCodeToKey]="languageCodeToKey"
                [currentLanguage]="currentLanguage"
                (closeModal)="closeisCompanyDetailsVisible()"
              ></app-company-details-modal>
              
            </div>
          </div>

          <!-- Updated Pagination Controls -->
          <div
            class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4"
            *ngIf="totalPages > 1"
          >
            <!-- Page Info -->
            <div class="text-sm text-gray-600">
              {{ "PAGE" | translate }} {{ currentPage }} {{ "OF" | translate }}
              {{ totalPages }} ({{ "TOTAL" | translate }}: {{ totalItems }}
              {{ "ITEMS" | translate }})
            </div>

            <!-- Pagination Navigation -->
            <div class="flex items-center space-x-2">
              <!-- First Page -->
              <button
                (click)="goToFirstPage()"
                [disabled]="!hasPrevious"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                [title]="'FIRST_PAGE' | translate"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                  ></path>
                </svg>
              </button>

              <!-- Previous Page -->
              <button
                (click)="goToPreviousPage()"
                [disabled]="!hasPrevious"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                [title]="'PREVIOUS_PAGE' | translate"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 19l-7-7 7-7"
                  ></path>
                </svg>
              </button>

              <!-- Page Numbers -->
              <div class="flex space-x-1">
                <button
                  *ngFor="let pageNum of pageNumbers"
                  (click)="goToPage(pageNum)"
                  [class]="
                    currentPage === pageNum
                      ? 'px-3 py-2 text-sm bg-[#085E5A] text-white rounded-md'
                      : 'px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50'
                  "
                >
                  {{ pageNum }}
                </button>
              </div>

              <!-- Next Page -->
              <button
                (click)="goToNextPage()"
                [disabled]="!hasNext"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                [title]="'NEXT_PAGE' | translate"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  ></path>
                </svg>
              </button>

              <!-- Last Page -->
              <button
                (click)="goToLastPage()"
                [disabled]="!hasNext"
                class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                [title]="'LAST_PAGE' | translate"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 5l7 7-7 7M5 5l7 7-7 7"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Loading indicator (optional) -->
          <div
            *ngIf="companies.length === 0 && totalItems === 0"
            class="text-center py-8"
          >
            <div class="text-gray-500">{{ "LOADING" | translate }}...</div>
          </div>
        </div>

        <!-- Message if No Companies Found -->
        <div
          *ngIf="
            (companies ?? []).length === 0 &&
            totalItems === 0 &&
            !isAddCompanyFormVisible
          "
          class="text-center text-gray-600 mt-4"
        >
          <h2 class="text-2xl font-semibold text-gray-700">
            {{ "noCompaniesAddedYet" | translate }}
          </h2>
          <p class="text-gray-500 text-lg">
            {{ "noCompaniesMessage" | translate }}
          </p>
          <button
            (click)="addCompany()"
            class="mt-4 bg-[#085E5A] text-white px-6 py-3 rounded-lg shadow-md hover:bg-[#064E4B] text-xl"
          >
            {{ "addCompany" | translate }}
          </button>
        </div>

        <!--editttttt-->
        <div
          *ngIf="isEdit"
          [formGroup]="companyForm"
          class="mt-8 bg-white shadow-lg rounded-lg p-6 sm:p-8 max-w-full sm:max-w-4xl mx-auto"
        >
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl sm:text-3xl font-semibold text-gray-800">
              {{ "editCompany" | translate }}
            </h2>
            <button
              type="button"
              (click)="closeForm()"
              class="text-gray-500 hover:text-red-600 text-2xl font-bold focus:outline-none"
            >
              &times;
            </button>
          </div>

          <form class="space-y-6">
            <!-- Company Information -->
            <div class="p-6 sm:p-6">
              <div
                class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
              >
                <svg
                  class="w-6 h-6 text-gray-800 dark:text-black"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 4h12M6 4v16M6 4H5m13 0v16m0-16h1m-1 16H6m12 0h1M6 20H5M9 7h1v1H9V7Zm5 0h1v1h-1V7Zm-5 4h1v1H9v-1Zm5 0h1v1h-1v-1Zm-3 4h2a1 1 0 0 1 1 1v4h-4v-4a1 1 0 0 1 1-1Z"
                  />
                </svg>
                <div class="font-medium text-lg text-gray-700">
                  {{ "companyInformation" | translate }}
                </div>
              </div>

              <div class="flex flex-col md:flex-row md:space-x-4">
                <div class="w-full md:w-1/2 mb-4 md:mb-0">
                  <label
                    for="companyName"
                    class="block text-base font-medium text-gray-700 mb-1"
                    >{{ "companyName" | translate }}
                  </label>
                  <input
                    type="text"
                    name="companyName"
                    id="companyName"
                    [(ngModel)]="companyData.name"
                    required
                    [placeholder]="'ENTER_COMPANY_NAME' | translate"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>

                <div class="w-1/2">
                  <label
                    for="uid"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "uid" | translate }}
                  </label>

                  <input
                    type="text"
                    name="unique_identifier"
                    id="unique_identifier"
                    [(ngModel)]="companyData.unique_identifier"
                    required
                    [placeholder]="'PLACEHOLDER_ENTER_UID' | translate"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>
              </div>
              <br />
              <!-- Company Profile -->
              <div class="mb-4">
                <label
                  for="companyProfile"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "companyProfile" | translate }}
                </label>
                <input
                  id="companyProfile"
                  name="companyProfile"
                  [(ngModel)]="companyData.company_profile"
                  required
                  [placeholder]="'ENTER_COMPANY_PROFILE' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />
              </div>

              <!-- Company Purpose -->
              <div class="mb-4">
                <label
                  for="companyPurpose"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "companyPurpose" | translate }}
                </label>
                <input
                  type="text"
                  id="companyPurpose"
                  name="companyPurpose"
                  [(ngModel)]="companyData.company_purpose"
                  required
                  [placeholder]="'ENTER_COMPANY_PURPOSE' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />
              </div>

              <div class="w-full mt-4">
                <label class="block text-base font-medium text-gray-700 mb-1">{{
                  "languages" | translate
                }}</label>

                <mat-select
                  required
                  [(ngModel)]="companyData.languages"
                  name="languages"
                  multiple
                >
                  <mat-option
                    *ngFor="let lang of availableLanguages"
                    [value]="lang"
                  >
                    {{ lang | translate }}
                  </mat-option>
                </mat-select>

                
              </div>

             

              <br />
              <!-- Address Information -->
              <div class="mb-6">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                    />
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.8 13.938h-.011a7 7 0 1 0-11.464.144h-.016l.14.171c.1.127.2.251.3.371L12 21l5.13-6.248c.194-.209.374-.429.54-.659l.13-.155Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "addressInformation" | translate }}
                  </div>
                </div>

                <div class="flex flex-col md:flex-row gap-4 mb-4">
                  <!-- Headquarters Address -->
                  <div class="w-full md:w-1/2">
                    <label
                      for="headquartersAddress"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "headquartersAddress" | translate }}</label
                    >
                    <input
                      type="text"
                      id="headquartersAddress"
                      name="headquartersAddress"
                      [(ngModel)]="companyData.headquarters"
                      required
                      [placeholder]="'ENTER_FULL_ADDRESS' | translate"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                  </div>

                  <!-- Branch Locations -->
                  <div class="w-full md:w-1/2">
                    <label
                      for="branchLocations"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "branchLocations" | translate }}
                    </label>
                    <input
                      type="text"
                      id="branchLocations"
                      [(ngModel)]="companyData.branch_locations"
                      name="branchLocations"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                  </div>
                </div>
              </div>

              <div class="flex gap-x-4 mb-4">
                <!-- Zip Code -->
                <div class="w-1/2">
                  <label
                    for="zipCode"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "zipCode" | translate }}
                  </label>
                  <input
                    type="text"
                    id="zipCode"
                    name="zipCode"
                    [(ngModel)]="companyData.zip_code"
                    [placeholder]="'ENTER_ZIP_CODE' | translate"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>

                <!-- Location -->
                <div class="w-1/2">
                  <label
                    for="location"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "location" | translate }}
                  </label>
                  <input
                    type="text"
                    id="location"
                    name="location"
                    [(ngModel)]="companyData.location"
                    [placeholder]="'ENTER_LOCATION' | translate"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>
              </div>

              <!-- Country -->
              <div class="mb-4">
                <label
                  for="country"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "country" | translate }}
                </label>
                <input
                  type="text"
                  id="country"
                  name="country"
                  [(ngModel)]="companyData.country"
                  [placeholder]="'ENTER_COUNTRY' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />
              </div>
              <!-- Phone Number -->
              <div class="mb-4">
                <label
                  for="company_phone_number"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "phoneNumber" | translate }}
                </label>
                <input
                  type="text"
                  id="company_phone_number"
                  name="company_phone_number"
                  [(ngModel)]="companyData.phone_number"
                  [placeholder]="'ENTER_PHONE_NUMBER' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />
              </div>

              <!-- Financial Reports edit Section -->

              <div class="mb-6">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black mr-2"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 3v4a1 1 0 0 1-1 1H5m14-4v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1Z"
                    />
                  </svg>
                  <div class="font-semibold text-lg text-gray-800 grow">
                    {{ "financialReports" | translate }}
                  </div>
                </div>

                <div class="mb-6">
                  <label
                    for="uploadDocuments"
                    class="block text-base font-medium text-gray-700 mb-2"
                  >
                    {{ "uploadCompanyDocuments" | translate }}</label
                  >
                  <div
                    class="border-dashed border-2 border-gray-300 rounded-lg p-6 flex justify-center items-center cursor-pointer hover:bg-gray-50 transition-all duration-200 ease-in-out relative"
                    (click)="fileInput.click()"
                  >
                    <input
                      #fileInput
                      type="file"
                      id="uploadDocuments"
                      (change)="onFileSelected($event)"
                      class="hidden absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                      multiple
                      aria-label="Upload company documents"
                      name="uploadDocuments"
                    />

                    <div class="text-center space-y-2">
                      <svg
                        class="w-6 h-6 text-gray-800 dark:text-[#085E5A] mx-auto"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 17h3a3 3 0 0 0 0-6h-.025a5.56 5.56 0 0 0 .025-.5A5.5 5.5 0 0 0 7.207 9.021C7.137 9.017 7.071 9 7 9a4 4 0 1 0 0 8h2.167M12 19v-9m0 0-2 2m2-2 2 2"
                        />
                      </svg>
                      <p class="text-gray-600 text-sm">
                        {{ "clickOrDragToUpload" | translate }}
                      </p>
                      <span class="text-[#085E5A] text-2xl">+</span>
                    </div>
                  </div>
                </div>

                <div *ngIf="uploadedFile" class="mt-4 text-gray-800">
                  <p class="font-medium">
                    Uploaded File: {{ uploadedFile.name }}
                  </p>
                </div>

                <div class="text-sm text-gray-500">
                  <p>
                    {{ "acceptedFileTypes" | translate }}
                    <span class="font-medium">PDF</span>.
                    {{ "maximumFileSize" | translate }}
                    <span class="font-medium">{{
                      "10MB per file" | translate
                    }}</span>
                    .
                  </p>
                </div>
              </div>

              <div
                *ngIf="errorMessages['general']"
                class="text-red-500 text-sm mb-4"
              >
                {{ errorMessages["general"] }}
              </div>

              <div *ngIf="successMessagee1" class="alert alert-success">
                {{ successMessagee1 }}
              </div>

              <div class="p-6 flex justify-end">
                <button
                  type="submit"
                  (click)="edit()"
                  class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                >
                  {{ "submit" | translate }}
                </button>
              </div>
            </div>

            <div class="mb-6 md:flex-row">
              
              <div class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2" >
            
                <div class="font-semibold text-lg text-gray-800 grow">
                  {{ "company_logo" | translate }}
                </div>
              </div>
                <div class="space-y-2 w-full mt-4">
                
                  <app-file-upload 
                    
                    [maxFileSize]="5"
                    acceptedTypes="image/*"
                    [returnBase64Only]="true"
                    [cleanBase64]="false"
                    (fileSelected)="onImageSelected($event, 'edit')"
                    (cleanBase64Generated)="onCleanBase64Generated($event)">
                  </app-file-upload>
                </div>

                <div
                    *ngIf="errorMessagesUpdateLogo"
                    class="text-red-500 text-sm mb-4"
                  >
                    {{ errorMessagesUpdateLogo }}
                  </div>

                  <div *ngIf="successMessagee6" class="alert alert-success">
                    {{ successMessagee6 }}
                  </div>

                  <div class="p-6 flex justify-end">
                    <button
                      type="submit"
                      (click)="updateCompanyLogo()"
                      class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                    >
                      {{ "submit" | translate }}
                    </button>
                  </div>
              </div>

            <!-- Legal Information -->
            <div class="p-6">
              <div class="mb-6">
                <!-- Legal Information Header -->
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m20.9532 11.7634-2.0523-2.05225-2.0523 2.05225 2.0523 2.0523 2.0523-2.0523Zm-1.3681-2.73651-4.1046-4.10457L12.06 8.3428l4.1046 4.1046 3.4205-3.42051Zm-4.1047 2.73651-2.7363-2.73638-8.20919 8.20918 2.73639 2.7364 8.2091-8.2092Z"
                    />
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m12.9306 3.74083 1.8658 1.86571-2.0523 2.05229-1.5548-1.55476c-.995-.99505-3.23389-.49753-3.91799.18657l2.73639-2.73639c.6841-.68409 1.9901-.74628 2.9229.18658Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "legalInformation" | translate }}
                  </div>
                </div>

                <!-- Legal Form and Registration Date -->
                <div class="flex mb-4">
                  <div class="w-1/2 mr-4">
                    <label
                      for="legalForm"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "legalForm" | translate }}
                    </label>
                    <div class="relative w-full">
                      <select
                        id="legalForm"
                        [(ngModel)]="companyData.legal_information.legal_forms"
                        name="legalForm"
                        required
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                        [class.border-red-500]="
                          errorMessages['legal_information.legal_forms']
                        "
                      >
                        <option
                          value=""
                          disabled
                          [selected]="
                            !companyData.legal_information.legal_forms
                          "
                        >
                          {{ "selectLegalForm" | translate }}
                        </option>
                        <option
                          *ngFor="let form of legalFormsList"
                          [value]="form.value"
                        >
                          {{ form.key | translate }}
                        </option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Legal Status and Sector -->
                <div class="flex mb-4">
                  <!-- Legal Status Dropdown -->
                  <div class="w-1/2 mr-4">
                    <label
                      for="legalStatus"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "legalStatus" | translate }}
                    </label>
                    <div class="relative w-full">
                      <select
                        id="legalStatus"
                        [(ngModel)]="companyData.legal_information.legal_status"
                        [class.border-red-500]="
                          errorMessages['legal_information.legal_status']
                        "
                        name="legalStatus"
                        required
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                      >
                        <option
                          selected
                          disabled
                          value=""
                          class="text-gray-400"
                        >
                          {{ "selectLegalStatus" | translate }}
                        </option>
                        <option
                          *ngFor="let status of legalStatusChoices"
                          [value]="status.value"
                        >
                          {{ status.label | translate }}
                        </option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>

                  <!-- Sector Dropdown -->
                  <div class="w-1/2">
                    <label
                      for="sector"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "sector" | translate }}
                    </label>
                    <div class="relative w-full">
                      <select
                        id="sector"
                        name="sector"
                        [(ngModel)]="companyData.legal_information.sector"
                        [class.border-red-500]="
                          errorMessages['legal_information.sector']
                        "
                        required
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                      >
                        <option
                          selected
                          disabled
                          value=""
                          class="text-gray-400"
                        >
                          {{ "enterCompanyIndustry" | translate }}
                        </option>
                        <option
                          *ngFor="let sector of sectorChoices"
                          [value]="sector.value"
                        >
                          {{ sector.label | translate }}
                        </option>
                      </select>
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                *ngIf="errorMessages['general']"
                class="text-red-500 text-sm mb-4"
              >
                {{ errorMessages["general"] }}
              </div>

              <div *ngIf="successMessagee2" class="alert alert-success">
                {{ successMessagee2 }}
              </div>
              <div class="p-6 flex justify-end">
                <button
                  type="submit"
                  (click)="edit2()"
                  class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                >
                  {{ "submit" | translate }}
                </button>
              </div>

              <!-- Management Details -->
              <div class="mb-6 md:flex-row">
                <!-- Section Header -->
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 8v8m0-8h8M8 8H6a2 2 0 1 1 2-2v2Zm0 8h8m-8 0H6a2 2 0 1 0 2 2v-2Zm8 0V8m0 8h2a2 2 0 1 1-2 2v-2Zm0-8h2a2 2 0 1 0-2-2v2Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "managementDetails" | translate }}
                  </div>
                </div>

                <!-- Directors List -->
                <div
                  class="flex flex-col gap-4 mb-4"
                  *ngFor="let director of companyData.directors; let i = index"
                >
                  <div class="flex flex-col md:flex-row md:space-x-4">
                    <div class="w-full md:w-1/3 mb-4">
                      <label
                        for="salutation"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "salutation" | translate }}
                      </label>
                      <div class="relative w-full">
                        <select
                          id="salutation"
                          [(ngModel)]="companyData.directors[i].salutation"
                          name="salutation"
                          class="appearance-none p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                        >
                          <option value="" disabled selected hidden>
                            {{ "ENTER_salutation" | translate }}
                          </option>
                          <option
                            *ngFor="let option of salutationOptions"
                            [value]="option"
                          >
                            {{ option | translate }}
                          </option>
                        </select>
                        <div
                          class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                        >
                          <svg
                            class="w-4 h-4"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        </div>
                      </div>
                    </div>

                    <div class="w-full md:w-1/3 mb-4">
                      <label
                        for="first_name"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "first_name" | translate }}
                      </label>
                      <input
                        type="text"
                        id="first_name"
                        [(ngModel)]="companyData.directors[i].first_name"
                        name="first_name"
                        [placeholder]="'ENTER_first_name' | translate"
                        class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                    </div>

                    <div class="w-full md:w-1/3 mb-4">
                      <label
                        for="last_name"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "last_name" | translate }}
                      </label>
                      <input
                        type="text"
                        id="last_name"
                        [(ngModel)]="companyData.directors[i].last_name"
                        name="last_name"
                        [placeholder]="'ENTER_last name' | translate"
                        class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                    </div>
                  </div>

                  <div
                    class="flex flex-col gap-4 mb-4"
                    *ngFor="
                      let director of companyData.directors;
                      let i = index
                    "
                  >
                    <div class="flex flex-col md:flex-row gap-4">
                      <div class="w-full md:w-1/2">
                        <label
                          for="email"
                          class="block text-base font-medium text-gray-700 mb-1"
                        >
                          {{ "Email" | translate }}
                        </label>
                        <input
                          type="email"
                          id="email"
                          [(ngModel)]="companyData.directors[i].email"
                          name="email"
                          [placeholder]="'ENTER_email' | translate"
                          class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                        />
                      </div>

                      <div class="w-full md:w-1/2">
                        <label
                          for="phone_number"
                          class="block text-base font-medium text-gray-700 mb-1"
                        >
                          {{ "direct line" | translate }}
                        </label>
                        <input
                          type="tel"
                          id="phone_number"
                          [(ngModel)]="companyData.directors[i].phone_number"
                          name="phone_number"
                          [placeholder]="'ENTER_phone_number' | translate"
                          class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- Role Input -->
                  <div class="w-full">
                    <label
                      for="role"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "role" | translate }}
                    </label>
                    <input
                      type="text"
                      id="role"
                      name="role"
                      [(ngModel)]="companyData.directors[i].role"
                      class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      placeholder="{{ 'ENTER_ROLE' | translate }}"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="errorMessages['directors.' + i + '.role']"
                    >
                      {{ errorMessages["directors." + i + ".role"] }}
                    </p>
                  </div>

                  <!-- number_of_employees Selection -->
                  <div class="w-full">
                    <label
                      for="number_of_employees"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "number_of_employees" | translate }}
                    </label>
                    <input
                      id="number_of_employees"
                      type="number"
                      name="number_of_employees"
                      [(ngModel)]="companyData.directors[i].number_of_employees"
                      [placeholder]="'ENTER number_of_employees' | translate"
                      class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                  </div>

                  <!-- Authorized Signatories -->
                  <div class="w-full">
                    <label
                      for="authorizedSignatories"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "authorizedSignatories" | translate }}
                    </label>
                    <input
                      type="text"
                      id="signature"
                      name="signature"
                      required
                      [placeholder]="
                        'PLACEHOLDER_ENTER_AUTHORIZED_PERSONS' | translate
                      "
                      [(ngModel)]="companyData.directors[i].signature"
                      class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="errorMessages['directors.' + i + '.signature']"
                    >
                      {{ errorMessages["directors." + i + ".signature"] }}
                    </p>
                  </div>
                </div>
                <div
                  *ngIf="errorMessages['general']"
                  class="text-red-500 text-sm mb-4"
                >
                  {{ errorMessages["general"] }}
                </div>
                <!-- Success Message -->
                <div *ngIf="successMessagee3" class="alert alert-success">
                  {{ successMessagee3 }}
                </div>

                <!-- Submit Button -->
                <div class="p-6 flex justify-end">
                  <button
                    type="submit"
                    (click)="edit3()"
                    class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                  >
                    {{ "submit" | translate }}
                  </button>
                </div>
              </div>

              <!-- Financial Information -->
              <div class="mb-6">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m7.14284 11 4.99996-6 5 6m-9.99996 0h-3v8H20.1428v-8h-3m-9.99996 0H3.14285l3-4h4.33735l-3.33736 4Zm9.99996 0h4l-3-4h-4.3374l3.3374 4Zm-3 2c0 1.1046-.8954 2-2 2-1.1045 0-2-.8954-2-2s.8955-2 2-2c1.1046 0 2 .8954 2 2Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "financialInformation" | translate }}
                  </div>
                </div>

                <div class="flex">
                  <div class="w-1/2 mr-4">
                    <label
                      for="company_capital"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "shareCapital" | translate }}
                    </label>
                    <input
                      type="text"
                      id="company_capital"
                      name="company_capital"
                      [placeholder]="
                        'PLACEHOLDER_ENTER_TOTAL_SHARE_CAPITAL' | translate
                      "
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      [(ngModel)]="
                        companyData.financial_information.company_capital
                      "
                      (input)="formatCapital($event)"
                      required
                    />
                  </div>
                </div>
                <br />
                <div
                  *ngIf="errorMessages['general']"
                  class="text-red-500 text-sm mb-4" >
                  {{ errorMessages["general"] }}
                </div>
                <div *ngIf="successMessagee4" class="alert alert-success">
                  {{ successMessagee4 }}
                </div>
                <div class="p-6 flex justify-end">
                  <button
                    type="submit"
                    (click)="edit4()"
                    class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                  >
                    {{ "submit" | translate }}
                  </button>
                </div>
              </div>

              <!-- Sustainability Projects -->
              <div class="mb-6 md:flex-row">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-width="2"
                      d="M8.737 8.737a21.49 21.49 0 0 1 3.308-2.724m0 0c3.063-2.026 5.99-2.641 7.331-1.3 1.827 1.828.026 6.591-4.023 10.64-4.049 4.049-8.812 5.85-10.64 4.023-1.33-1.33-.736-4.218 1.249-7.253m6.083-6.11c-3.063-2.026-5.99-2.641-7.331-1.3-1.827 1.828-.026 6.591 4.023 10.64m3.308-9.34a21.497 21.497 0 0 1 3.308 2.724m2.775 3.386c1.985 3.035 2.579 5.923 1.248 7.253-1.336 1.337-4.245.732-7.295-1.275M14 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "sustainabilityActivities" | translate }}
                  </div>
                </div>

                <div class="mb-4 flex space-x-4">
                  <div class="w-1/2">
                    <label
                      for="projectActivity"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "projectActivity" | translate }}</label
                    >
                    <input
                      type="text"
                      id="projectActivity"
                      [placeholder]="'PLACEHOLDER_PROJECT_NAME' | translate"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      [(ngModel)]="companyData.activity.project_name"
                      required
                      name="projectActivity"
                    />
                  </div>
                  <div class="w-1/2">
                    <label
                      for="location"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "location" | translate }}</label
                    >
                    <input
                      type="text"
                      id="location"
                      [placeholder]="'PLACEHOLDER_PROJECT_NAME' | translate"
                      [(ngModel)]="companyData.activity.location"
                      required
                      name="location"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                  </div>
                </div>
                <div class="mb-4 flex space-x-4">
                  <div class="w-full">
                    <label
                      for="sector"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "details" | translate }}</label
                    >
                    <input
                      type="text"
                      id="details"
                      name="details"
                      [placeholder]="'PLACEHOLDER_ENTER_DETAILS' | translate"
                      [(ngModel)]="companyData.activity.details"
                      required
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                  </div>
                </div>

                <div
                  *ngIf="errorMessages['general']"
                  class="text-red-500 text-sm mb-4"
                >
                  {{ errorMessages["general"] }}
                </div>
                <div *ngIf="successMessagee5" class="alert alert-success">
                  {{ successMessagee5 }}
                </div>
                <div class="text-right mt-8">
                  <div class="p-6 flex justify-end">
                    <button
                      type="submit"
                      (click)="edit5()"
                      class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                    >
                      {{ "submit" | translate }}
                    </button>
                  </div>
                </div>

                <div
                  *ngIf="errorMessages['general']"
                  class="text-red-500 text-sm mt-2"
                >
                  {{ errorMessages["general"] }}
                </div>
              </div>
              <button
                (click)="closeForm()"
                type="button"
                class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-600 w-full"
              >
                Close
              </button>
            </div>
          </form>
        </div>

        <!-- Company Registration Form (Visible when isAddCompanyFormVisible is true) -->
        <div
          *ngIf="isAddCompanyFormVisible"
          class="mt-8 bg-white shadow-lg rounded-lg p-4 sm:p-6 md:p-8 max-w-4xl mx-auto"
        >
          <h2 class="text-2xl sm:text-3xl font-semibold mb-6 text-gray-800">
            {{ "registerNewCompany" | translate }}
          </h2>

          <form class="space-y-6" [formGroup]="addForm">
            <!-- Company Information -->
            <div class="p-6 md:flex-row">
              <div
                class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
              >
                <svg
                  class="w-6 h-6 text-gray-800 dark:text-black"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 4h12M6 4v16M6 4H5m13 0v16m0-16h1m-1 16H6m12 0h1M6 20H5M9 7h1v1H9V7Zm5 0h1v1h-1V7Zm-5 4h1v1H9v-1Zm5 0h1v1h-1v-1Zm-3 4h2a1 1 0 0 1 1 1v4h-4v-4a1 1 0 0 1 1-1Z"
                  />
                </svg>
                <div class="font-medium text-lg text-gray-700">
                  {{ "companyInformation" | translate }}
                </div>
              </div>

              <div class="flex">
                <div class="w-1/2 mr-4">
                  <label
                    for="companyName"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "companyName" | translate }}
                    <span class="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    name="companyName"
                    id="companyName"
                    formControlName="companyName"
                    required
                    [placeholder]="
                      'PLACEHOLDER_ENTER_REGISTERED_COMPANY_NAME' | translate
                    "
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />

                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['companyName'].invalid &&
                      addForm.controls['companyName'].touched
                    "
                  >
                    {{ "This field is required" | translate }}
                  </p>
                </div>

                <div class="w-1/2">
                  <label
                    for="unique_identifier"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "uid" | translate }}
                    <span class="text-red-500">*</span>
                  </label>

                  <input
                    type="text"
                    name="unique_identifier"
                    id="unique_identifier"
                    formControlName="unique_identifier"
                    required
                    [placeholder]="'PLACEHOLDER_ENTER_UID' | translate"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['unique_identifier'].hasError(
                        'required'
                      ) && addForm.controls['unique_identifier'].touched
                    "
                  >
                    {{ "This field is required" | translate }}
                  </p>

                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['unique_identifier'].hasError(
                        'pattern'
                      ) && addForm.controls['unique_identifier'].touched
                    "
                  >
                    {{ "Invalid format. Use CHE-XXX.XXX.XXX" | translate }}
                  </p>
                </div>
              </div>

              <!-- Company Purpose -->
              <div class="w-full mt-4">
                <label
                  for="companyPurpose"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "Company Purpose" | translate }}
                  <span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  name="companyPurpose"
                  id="companyPurpose"
                  formControlName="companyPurpose"
                  [placeholder]="'Enter company purpose' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />
                <p
                  class="text-red-500 text-sm"
                  *ngIf="
                    addForm.controls['companyPurpose'].hasError('required') &&
                    addForm.controls['companyPurpose'].touched
                  "
                >
                  {{ "This field is required" | translate }}
                </p>
              </div>

              <!-- Company Profile -->
              <div class="w-full mt-4">
                <label
                  for="companyProfile"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "Company Profile" | translate }}
                </label>
                <input
                  type="url"
                  name="companyProfile"
                  id="companyProfile"
                  formControlName="companyProfile"
                  [placeholder]="'Enter company profile URL' | translate"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                />

                <p
                  class="text-red-500 text-sm"
                  *ngIf="
                    addForm.controls['companyProfile'].hasError('pattern') &&
                    addForm.controls['companyProfile'].touched
                  "
                >
                  {{ "Please enter a valid URL" | translate }}
                </p>
              </div>
              <!-- Multi-select dropdown for Languages -->
              <div class="w-full mt-4">
                <label
                  for="languages"
                  class="block text-base font-medium text-gray-700 mb-1"
                >
                  {{ "languages" | translate }}
                  <span class="text-red-500">*</span>
                </label>

                <mat-select
                  class="custom-dropdown-style"
                  formControlName="languages"
                  multiple
                  [placeholder]="'Choose_Languages' | translate"
                >
                  <mat-option
                    *ngFor="let lang of availableLanguages"
                    [value]="lang"
                  >
                    {{ "LANGUAGES." + lang | translate }}
                  </mat-option>
                </mat-select>

                <p
                  class="text-red-500 text-sm"
                  *ngIf="
                    addForm.controls['languages'].hasError('required') &&
                    addForm.controls['languages'].touched
                  "
                >
                  {{ "This field is required" | translate }}
                </p>
              </div>
               
                <!-- Logo Upload -->
                  <div class="space-y-2 w-full mt-4">
                    <!-- <label class="block text-sm font-medium text-gray-700">Company Logo</label> -->
                    <label
                      for="companyProfile"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "company_logo" | translate }}
                   </label>
                   
                    <app-file-upload 
                      formControlName="logo"
                      [maxFileSize]="5"
                      acceptedTypes="image/*"
                      [returnBase64Only]="true"
                      [cleanBase64]="false"
                      (fileSelected)="onImageSelected($event)"
                      (cleanBase64Generated)="onCleanBase64Generated($event)">
                    </app-file-upload>
                  </div>

                  <div *ngIf="addForm.get('logo')?.value" class="p-3 bg-green-50 border border-green-200 rounded text-sm">
                    <div class="flex items-center text-green-700">
                      <mat-icon class="!text-sm !mr-2">check_circle</mat-icon>
                      <strong>Clean Base64 Ready for Storage</strong>
                    </div>
                    <div class="mt-2 text-xs text-gray-600">
                      <p>Length: {{ addForm.get('logo')?.value?.length }} characters</p>
                      <p>Data URL prefix removed: </p>
                      <p>Preview: {{ addForm.get('logo')?.value?.substring(0, 50) }}...</p>
                    </div>
                  </div>
              </div>

            <!-- Legal Information -->
            <div class="p-6">
              <div class="mb-6 md:flex-row">
                <!-- Legal Information Header -->
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m20.9532 11.7634-2.0523-2.05225-2.0523 2.05225 2.0523 2.0523 2.0523-2.0523Zm-1.3681-2.73651-4.1046-4.10457L12.06 8.3428l4.1046 4.1046 3.4205-3.42051Zm-4.1047 2.73651-2.7363-2.73638-8.20919 8.20918 2.73639 2.7364 8.2091-8.2092Z"
                    />
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m12.9306 3.74083 1.8658 1.86571-2.0523 2.05229-1.5548-1.55476c-.995-.99505-3.23389-.49753-3.91799.18657l2.73639-2.73639c.6841-.68409 1.9901-.74628 2.9229.18658Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "legalInformation" | translate }}
                  </div>
                </div>

                <!-- Legal Form and Registration Date -->
                <div class="flex mb-4">
                  <div class="w-1/2 mr-4 relative">
                    <label
                      for="legalForm"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "legalForm" | translate }}
                      <span class="text-red-500">*</span>
                    </label>

                    <div class="relative w-full">
                      <select
                        id="legalForm"
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400 pr-10"
                        formControlName="legal_forms"
                        name="legal_forms"
                        [class.border-red-500]="
                          errorMessages['legal_information.legal_forms']
                        "
                        required
                      >
                        <option
                          value=""
                          disabled
                          selected
                          class="text-gray-400"
                        >
                          {{ "selectLegalForm" | translate }}
                        </option>
                        <option
                          *ngFor="let form of legalFormsList"
                          [value]="form.key"
                        >
                          {{ form.key | translate }}
                        </option>
                      </select>

                      <!-- Arrow -->
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>

                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.get('legal_forms')?.invalid &&
                        addForm.get('legal_forms')?.touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>

                <!-- Legal Status and Sector -->
                <div class="flex mb-4">
                  <!-- Legal Status -->
                  <div class="w-1/2 mr-4">
                    <label
                      for="legalStatus"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "legalStatus" | translate }}
                      <span class="text-red-500">*</span>
                    </label>
                    <div class="relative w-full">
                      <select
                        id="legalStatus"
                        formControlName="legal_status"
                        [class.border-red-500]="
                          errorMessages['legal_information.legal_status']
                        "
                        name="legalStatus"
                        required
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                      >
                        <option
                          selected
                          disabled
                          value=""
                          class="text-gray-400"
                        >
                          {{ "selectLegalStatus" | translate }}
                        </option>
                        <option
                          *ngFor="let status of legalStatusChoices"
                          [value]="status.value"
                        >
                          {{ status.label | translate }}
                        </option>
                      </select>
                      <!-- Arrow -->
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['legal_status'].invalid &&
                        addForm.controls['legal_status'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>

                  <!-- Sector -->
                  <div class="w-1/2">
                    <label
                      for="sector"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "sector" | translate }}
                      <span class="text-red-500">*</span>
                    </label>
                    <div class="relative w-full">
                      <select
                        id="sector"
                        name="sector"
                        formControlName="sector"
                        [class.border-red-500]="
                          errorMessages['legal_information.sector']
                        "
                        required
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none text-gray-400"
                      >
                        <option
                          selected
                          disabled
                          value=""
                          class="text-gray-400"
                        >
                          {{ "enterCompanyIndustry" | translate }}
                        </option>
                        <option
                          *ngFor="let sector of sectorChoices"
                          [value]="sector.value"
                        >
                          {{ sector.label | translate }}
                        </option>
                      </select>
                      <!-- Arrow -->
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['sector'].invalid &&
                        addForm.controls['sector'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Address Information -->
              <div class="mb-6 md:flex-row">
                <!-- Section Title -->
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2 w-full"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                    />
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.8 13.938h-.011a7 7 0 1 0-11.464.144h-.016l.14.171c.1.127.2.251.3.371L12 21l5.13-6.248c.194-.209.374-.429.54-.659l.13-.155Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "addressInformation" | translate }} 
                  </div>
                </div>

                <!-- Form Inputs Group 1 -->
                <div class="flex flex-col gap-y-4 w-full">
                  <div class="flex gap-x-4 mb-4">
                    <!-- Headquarters Address -->
                    <div class="w-1/2">
                      <label
                        for="headquartersAddress"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "headquartersAddress" | translate }}
                        <span class="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        id="headquartersAddress"
                        name="headquartersAddress"
                        formControlName="headquartersAddress"
                        required
                        [placeholder]="'ENTER_FULL_ADDRESS' | translate"
                        class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                      <p
                        class="text-red-500 text-sm"
                        *ngIf="
                          addForm.controls['headquartersAddress'].invalid &&
                          addForm.controls['headquartersAddress'].touched
                        "
                      >
                        {{ "This field is required" | translate }}
                      </p>
                    </div>

                    <!-- ZIP Code -->
                    <div class="w-1/2">
                      <label
                        for="zipCode"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "Zip Code" | translate }}
                        <span class="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        id="zipCode"
                        name="zipCode"
                        formControlName="zip_code"
                        required
                        [placeholder]="'Enter ZIP Code' | translate"
                        class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                      <p
                        class="text-red-500 text-sm"
                        *ngIf="
                          addForm.controls['zip_code'].invalid &&
                          addForm.controls['zip_code'].touched
                        "
                      >
                        {{ "This field is required" | translate }}
                      </p>
                    </div>
                  </div>

                  <!-- Form Inputs Group 2 -->
                  <div class="flex gap-x-4 mb-4">
                    <!-- Location -->
                    <div class="w-1/2">
                      <label
                        for="location"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "Location" | translate }}
                        <span class="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        id="location"
                        formControlName="location"
                        name="location"
                        placeholder="{{ 'Enter location' | translate }}"
                        class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                      <p
                        class="text-red-500 text-sm"
                        *ngIf="
                          addForm.controls['location'].invalid &&
                          addForm.controls['location'].touched
                        "
                      >
                        {{ "This field is required" | translate }}
                      </p>
                    </div>

                    <!-- Phone Number -->
                    <div class="w-1/2">
                      <label
                        for="company_phone_number"
                        class="block text-base font-medium text-gray-700 mb-1"
                      >
                        {{ "phone_number" | translate }}
                        <span class="text-red-500">*</span>
                      </label>
                      <input
                        id="company_phone_number"
                        type="tel"
                        name="company_phone_number"
                        formControlName="company_phone_number"
                        [placeholder]="'ENTER_phone_number' | translate"
                        class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      />
                      <p
                        class="text-red-500 text-sm"
                        *ngIf="
                          addForm.controls['company_phone_number'].invalid &&
                          addForm.controls['company_phone_number'].touched
                        "
                      >
                        {{
                          "This field is required and must be a valid number"
                            | translate
                        }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex gap-x-4 mb-4">
                <!-- Country -->
                <!-- Country -->
                <div class="w-1/2 relative">
                  <label
                    for="country"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "Country" | translate }}
                    <span class="text-red-500">*</span>
                  </label>
                  <div class="relative w-full">
                    <select
                      id="country"
                      formControlName="country"
                      name="country"
                      class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none pr-10 text-gray-400"
                    >
                      <option value="" disabled selected>
                        {{ "Select a country" | translate }}
                      </option>
                      <option
                        *ngFor="let country of countries"
                        [value]="country.value"
                      >
                        {{ country.label | translate }}
                      </option>
                    </select>
                    <!-- Custom arrow -->
                    <div
                      class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                    >
                      <svg
                        class="w-4 h-4"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                  </div>
                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['country'].invalid &&
                      addForm.controls['country'].touched
                    "
                  >
                    {{ "This field is required" | translate }}
                  </p>
                </div>

                <!-- Add More Button
                    <button class="text-[#085E5A] block ml-auto">{{ 'addMore' | translate }}</button> -->
              </div>

              <!-- Branch Locations Section -->
              <div class="w-1/2 md:flex-row">
                <!-- Toggle Button -->
                <button
                  type="button"
                  class="text-lg text-[#085E5A] font-semibold hover:underline mb-2"
                  (click)="showBranchInput = !showBranchInput"
                >
                  + {{ "branchLocations" | translate }}
                </button>

                <!-- Text Input Field (Shown on Click) -->
                <div *ngIf="showBranchInput">
                  <input
                    type="text"
                    id="branchLocations"
                    formControlName="branchLocations"
                    name="branchLocations"
                    placeholder="{{ 'Enter branch location' | translate }}"
                    class="p-2 w-full text-base border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>
              </div>
              <br />
              <!-- Management Details -->
              <div class="mb-6 md:flex-row">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 8v8m0-8h8M8 8H6a2 2 0 1 1 2-2v2Zm0 8h8m-8 0H6a2 2 0 1 0 2 2v-2Zm8 0V8m0 8h2a2 2 0 1 1-2 2v-2Zm0-8h2a2 2 0 1 0-2-2v2Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "managementDetails" | translate }}
                  </div>
                </div>

                <!-- Inputs Section -->

                <div
                  class="flex flex-col md:flex-row md:space-x-4"
                  *ngFor="let director of companyData?.directors; let i = index"
                >
                  <!-- Salutation -->
                  <div class="w-full md:w-1/3 mb-4 relative">
                    <label
                      for="salutation"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "salutation" | translate }}
                      <span class="text-red-500">*</span>
                    </label>
                    <div class="relative w-full">
                      <select
                        id="salutation"
                        formControlName="salutation"
                        class="appearance-none p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none pr-10 text-gray-400"
                      >
                        <option value="" disabled selected>
                          {{ "SELECT_salutation" | translate }}
                        </option>
                        <option
                          *ngFor="let option of salutationOptions"
                          [value]="option"
                        >
                          {{ option | translate }}
                        </option>
                      </select>
                      <!-- Custom arrow -->
                      <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                      >
                        <svg
                          class="w-4 h-4"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['salutation'].invalid &&
                        addForm.controls['salutation'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>

                  <!--  First Name -->
                  <div class="w-full md:w-1/3 mb-4">
                    <label
                      for="first_name"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "first_name" | translate }}
                      <span class="text-red-500">*</span>
                    </label>
                    <input
                      id="first_name"
                      type="text"
                      name="first_name"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      [placeholder]="'ENTER_first_name ' | translate"
                      formControlName="first_name"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['first_name'].invalid &&
                        addForm.controls['first_name'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>

                  <!--  Last Name -->
                  <div class="w-full md:w-1/3 mb-4">
                    <label
                      for="last_name"
                      class="block text-base font-medium text-gray-700 mb-1"
                      >{{ "last_name" | translate }}
                      <span class="text-red-500">*</span>
                    </label>
                    <input
                      id="last_name"
                      type="text"
                      name="last_name"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      [placeholder]="'ENTER_last_name ' | translate"
                      formControlName="last_name"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['last_name'].invalid &&
                        addForm.controls['last_name'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>
              </div>
              <div
                class="flex flex-col gap-4 mb-4"
                *ngFor="let director of companyData.directors; let i = index"
              >
                <!-- Email -->
                <div class="w-full md:w-1/2">
                  <label
                    for="email"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "Email" | translate }}
                  </label>
                  <input
                    id="email"
                    type="email"
                    name="email"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    [placeholder]="'ENTER_email' | translate"
                    formControlName="email"
                  />
                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['email'].invalid &&
                      addForm.controls['email'].touched
                    "
                  >
                    {{
                      "This field is required and must be a valid email"
                        | translate
                    }}
                  </p>
                </div>

                <!-- Phone Number -->

                <div class="w-full md:w-1/2">
                  <label
                    for="phone_number"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "direct line" | translate }}
                  </label>
                  <input
                    id="director_phone_number"
                    type="tel"
                    name="director_phone_number"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    [placeholder]="'ENTER_phone_number' | translate"
                    formControlName="director_phone_number"
                  />
                  <p
                    class="text-red-500 text-sm"
                    *ngIf="
                      addForm.controls['director_phone_number'].invalid &&
                      addForm.controls['director_phone_number'].touched
                    "
                  >
                    {{
                      "This field is required and must be a valid number"
                        | translate
                    }}
                  </p>
                </div>
              </div>

              <div
                class="flex gap-4 mb-4"
                *ngFor="let director of companyData.directors; let i = index"
              >
                <!-- Role Input -->
                <div class="w-full">
                  <label
                    for="role"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "role" | translate }}
                  </label>
                  <input
                    type="text"
                    id="role"
                    name="role"
                    formControlName="role"
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    placeholder="{{ 'Enter role' | translate }}"
                  />
                </div>
              </div>

              <div class="w-full">
                <label
                  for="number_of_employees"
                  class="block text-base font-medium text-gray-700 mb-1"
                  >{{ "number_of_employees" | translate }}</label
                >
                <input
                  id="number_of_employees"
                  type="number"
                  name="number_of_employees"
                  class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  [placeholder]="'ENTER_number_of_employees ' | translate"
                  formControlName="number_of_employees"
                />
              </div>
              <br />
              <!-- Authorized Signatories -->
              <div class="mb-4 p-2 rounded-t-lg">
                <button
                  (click)="showSignatureField = !showSignatureField"
                  class="text-lg text-[#085E5A] font-semibold hover:underline mb-2"
                >
                  + {{ "Authorized Signatures" | translate }}
                </button>

                <div *ngIf="showSignatureField" class="mt-4">
                  <label
                    for="signature"
                    class="block text-base font-medium text-gray-700 mb-1"
                  >
                    {{ "authorizedSignatories" | translate }}
                  </label>
                  <input
                    type="text"
                    id="signature"
                    name="signature"
                    formControlName="signature"
                    [placeholder]="
                      'PLACEHOLDER_ENTER_AUTHORIZED_PERSONS' | translate
                    "
                    class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                  />
                </div>
              </div>

              <!-- Financial Information -->
              <div class="mb-6 md:flex-row">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m7.14284 11 4.99996-6 5 6m-9.99996 0h-3v8H20.1428v-8h-3m-9.99996 0H3.14285l3-4h4.33735l-3.33736 4Zm9.99996 0h4l-3-4h-4.3374l3.3374 4Zm-3 2c0 1.1046-.8954 2-2 2-1.1045 0-2-.8954-2-2s.8955-2 2-2c1.1046 0 2 .8954 2 2Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "financialInformation" | translate }}
                  </div>
                </div>

                <div class="flex">
                  <div class="w-1/2 mr-4">
                    <label
                      for="shareCapital"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "shareCapital" | translate }}</label
                    >
                    <input
                      type="text"
                      id="company_capital"
                      name="company_capital"
                      [placeholder]="
                        'PLACEHOLDER_ENTER_TOTAL_SHARE_CAPITAL' | translate
                      "
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      formControlName="company_capital"
                      
                      (input)="formatCapital($event)"
                      (focus)="onFocus($event)"
                      (blur)="onBlur($event)"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['company_capital'].invalid &&
                        addForm.controls['company_capital'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Sustainability Projects -->
              <div class="mb-6 md:flex-row">
                <div
                  class="mb-4 bg-[#EBF4F2] p-2 rounded-t-lg flex items-center space-x-2"
                >
                  <svg
                    class="w-6 h-6 text-gray-800 dark:text-black"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-width="2"
                      d="M8.737 8.737a21.49 21.49 0 0 1 3.308-2.724m0 0c3.063-2.026 5.99-2.641 7.331-1.3 1.827 1.828.026 6.591-4.023 10.64-4.049 4.049-8.812 5.85-10.64 4.023-1.33-1.33-.736-4.218 1.249-7.253m6.083-6.11c-3.063-2.026-5.99-2.641-7.331-1.3-1.827 1.828-.026 6.591 4.023 10.64m3.308-9.34a21.497 21.497 0 0 1 3.308 2.724m2.775 3.386c1.985 3.035 2.579 5.923 1.248 7.253-1.336 1.337-4.245.732-7.295-1.275M14 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"
                    />
                  </svg>
                  <div class="font-medium text-lg text-gray-700">
                    {{ "sustainabilityActivities" | translate }}
                  </div>
                </div>

                <div class="mb-4 flex space-x-4">
                  <div class="w-1/2">
                    <label
                      for="projectActivity"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "projectActivity" | translate }}
                    </label>
                    <input
                      type="text"
                      id="projectActivity"
                      [placeholder]="'PLACEHOLDER_PROJECT_NAME' | translate"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                      formControlName="projectActivity"
                      name="projectActivity"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['projectActivity'].invalid &&
                        addForm.controls['projectActivity'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                  <div class="w-1/2">
                    <label
                      for="location"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "location" | translate }}
                    </label>
                    <input
                      type="text"
                      id="location"
                      [placeholder]="'ENTER_LOCATION' | translate"
                      formControlName="location"
                      name="location"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['location'].invalid &&
                        addForm.controls['location'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>
                <div class="mb-4 flex space-x-4">
                  <div class="w-full">
                    <label
                      for="sector"
                      class="block text-base font-medium text-gray-700 mb-1"
                    >
                      {{ "details" | translate }}</label
                    >
                    <input
                      type="text"
                      id="details"
                      name="details"
                      [placeholder]="'PLACEHOLDER_ENTER_DETAILS' | translate"
                      formControlName="details"
                      class="p-2 w-full text-base rounded-none border-b border-gray-300 focus:ring-0 focus:border-[#085E5A] outline-none"
                    />
                    <p
                      class="text-red-500 text-sm"
                      *ngIf="
                        addForm.controls['details'].invalid &&
                        addForm.controls['details'].touched
                      "
                    >
                      {{ "This field is required" | translate }}
                    </p>
                  </div>
                </div>
                <!-- Financial Reports Section -->

                <!-- Replace your file upload section in the HTML with this improved version -->

                <!-- Financial Reports Section -->
                <div class="mb-6">
                  <div class="block text-base font-medium text-gray-700 mb-1">
                    {{ "financialReports" | translate }}
                  </div>

                  <div class="mb-6">
                    <label class="text-sm font-normal text-gray-700 mb-2">
                      {{ "uploadCompanyDocuments" | translate }}
                    </label>
                    <div
                      class="border-dashed border-2 border-gray-300 rounded-lg p-6 flex justify-center items-center cursor-pointer hover:bg-gray-50 transition-all duration-200 ease-in-out relative"
                      (click)="fileInput.click()"
                    >
                      <!-- File Input -->
                      <input
                        #fileInput
                        type="file"
                        id="uploadDocuments"
                        name="uploadDocuments"
                        accept=".pdf,application/pdf"
                        (change)="onFileSelected($event)"
                        class="hidden absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                        multiple="false"
                        aria-label="Upload company documents"
                      />

                      <!-- Upload UI -->
                      <div class="text-center space-y-2">
                        <svg
                          class="w-6 h-6 text-gray-800 dark:text-[#085E5A] mx-auto"
                          aria-hidden="true"
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          fill="none"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 17h3a3 3 0 0 0 0-6h-.025a5.56 5.56 0 0 0 .025-.5A5.5 5.5 0 0 0 7.207 9.021C7.137 9.017 7.071 9 7 9a4 4 0 1 0 0 8h2.167M12 19v-9m0 0-2 2m2-2 2 2"
                          />
                        </svg>
                        <label
                          for="uploadDocuments"
                          class="block text-base font-medium text-gray-700 mb-2 cursor-pointer"
                        >
                          {{ "clickOrDragToUpload" | translate }}
                        </label>
                        <span class="text-[#085E5A] text-2xl">+</span>
                      </div>
                    </div>
                  </div>

                  <!-- Display the uploaded file if one exists -->
                  <div
                    *ngIf="uploadedFile"
                    class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg"
                  >
                    <div class="flex items-center space-x-2">
                      <svg
                        class="w-5 h-5 text-green-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M5 13l4 4L19 7"
                        ></path>
                      </svg>
                      <p class="text-green-800 font-medium">
                        {{ "FILE_UPLOADED" | translate }}:
                        {{ uploadedFile.name }}
                      </p>
                    </div>
                    <p class="text-green-600 text-sm mt-1">
                      {{ "FILE_SIZE" | translate }}:
                      {{ (uploadedFile.size / 1024 / 1024).toFixed(2) }} MB
                    </p>
                  </div>

                  <!-- Error Message -->
                  <div
                    *ngIf="errorMessage"
                    class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"
                  >
                    <div class="flex items-center space-x-2">
                      <svg
                        class="w-5 h-5 text-red-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                      <p class="text-red-800 font-medium">{{ errorMessage }}</p>
                    </div>
                  </div>

                  <!-- File Type Information -->
                  <div class="text-sm text-gray-500 mt-3">
                    <p>
                      {{ "acceptedFileTypes" | translate }}
                      <span class="font-medium">PDF</span>.
                      {{ "maximumFileSize" | translate }}
                      <span class="font-medium">{{
                        "10MB per file" | translate
                      }}</span
                      >.
                    </p>
                  </div>
                </div>

                <div
                  *ngIf="errorMessage"
                  class="mt-2 text-red-600 bg-red-100 p-2 rounded-md border border-red-300"
                >
                  {{ errorMessage }}
                </div>

                <div
                  *ngIf="errorMessages['companyCreation']"
                  class="text-red-500 bg-red-100 p-2 rounded-md"
                >
                  {{ errorMessages["companyCreation"] }}
                </div>
                <div
                  *ngIf="errorMessages['formValidation']"
                  class="text-red-500 text-sm mb-4"
                >
                  {{ errorMessages["formValidation"] }}
                </div>

                <div class="text-right mt-8">
                  <div class="p-6 flex justify-end">
                    <button
                      type="submit"
                      (click)="submitCompany()"
                      class="bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064A48]"
                    >
                      {{ "submit" | translate }}
                    </button>
                    <button
                      type="button"
                      (click)="cancelCompanyForm()"
                      class="text-[#085E5A] py-2 px-4 rounded-lg ml-4 border border-[#085E5A]"
                    >
                      {{ "cancel" | translate }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Contact Section -->
      <!-- <div class="py-6 flex flex-col" *ngIf="activeTab === 'contact'">
        <div class="contact-container">
          <div class="contact-info">
            <h1 class="section-title">{{ "search.address" | translate }}</h1>
            <p>
              {{
                parentCompany?.address ||
                  ("search.addressNotAvailable" | translate)
              }}
            </p>
            <p>
              {{
                parentCompany?.zip_code ||
                  ("search.zipNotAvailable" | translate)
              }}
              {{
                parentCompany?.city || ("search.cityNotAvailable" | translate)
              }}
            </p>
          </div>

          <div class="opening-hours">
            <h1 class="section-title" translate="search.openingHours"></h1>
            <p>
              {{
                workDaysMap[parentCompany?.work_days]
                  ? (workDaysMap[parentCompany?.work_days] | translate)
                  : parentCompany?.work_days ||
                    ("search.workdaysNotAvailable" | translate)
              }}
            </p>
            <p>
              {{
                parentCompany?.work_hours ||
                  ("search.workhourNotAvailable" | translate)
              }}
            </p>
          </div>
        </div>
         <div class="contact p-2">
            <h1 class="section-title ml-6" translate="search.contact"></h1>
            
            <div class="flex items-center">
              <img src="/assets/2709.svg" alt="email" class="pr-2 h-10 w-10" />
              <span>{{
                parentCompany?.email || ("search.emailNotAvailable" | translate)
              }}</span>
            </div>
            <div>
              <span class="pr-2"> &nbsp;&nbsp;</span>
              <span>{{
                parentCompany?.phone_number ||
                  ("search.phoneNotAvailable" | translate)
              }}</span>
            </div>
        </div>
        <style>
          .contact-line {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
          }
        </style>
      </div> -->
      <div class="py-6 px-4 sm:px-6" *ngIf="activeTab === 'contact'">
        <!-- 
          Main container for contact information.
          - 'grid' creates a grid layout.
          - 'gap-8' adds space between grid items.
          - 'md:grid-cols-2' makes it a two-column grid on medium screens and up.
            On smaller screens, it defaults to a single column, stacking the items.
        -->
        <div class="grid gap-8 md:grid-cols-2">
          <!-- Address and Opening Hours Section -->
          <div>
            <!-- Address Block -->
            <div class="mb-6">
              <h1 class="text-lg font-semibold text-gray-800 mb-2">
                {{ "search.address" | translate }}
              </h1>
              <p class="text-gray-600">
                {{ parentCompany?.address || ("search.addressNotAvailable" | translate) }}
              </p>
              <p class="text-gray-600">
                {{ parentCompany?.zip_code || ("search.zipNotAvailable" | translate) }}
                {{ parentCompany?.city || ("search.cityNotAvailable" | translate) }}
              </p>
            </div>
      
            <!-- Opening Hours Block -->
            <div>
              <h1 class="text-lg font-semibold text-gray-800 mb-2" translate="search.openingHours"></h1>
              <p class="text-gray-600">
                {{
                  workDaysMap[parentCompany?.work_days]
                    ? (workDaysMap[parentCompany?.work_days] | translate)
                    : parentCompany?.work_days || ("search.workdaysNotAvailable" | translate)
                }}
              </p>
              <p class="text-gray-600">
                {{ parentCompany?.work_hours || ("search.workhourNotAvailable" | translate) }}
              </p>
            </div>
          </div>
      
          <!-- Contact Details Section -->
          <div>
            <h1 class="text-lg font-semibold text-gray-800 mb-2" translate="search.contact"></h1>
            <!-- 
              Using a flex container with 'flex-col' to stack contact items vertically.
              'space-y-3' adds vertical spacing between the items.
            -->
            <div class="flex flex-col space-y-3">
              <!-- Email Contact Item -->
              <div class="flex items-center">
                <img src="/assets/2709.svg" alt="email" class="h-6 w-6 mr-3 text-gray-500" />
                <span class="text-gray-600">
                  {{ parentCompany?.email || ("search.emailNotAvailable" | translate) }}
                </span>
              </div>
      
              <!-- Phone Contact Item -->
              <div class="flex items-center">
                <!-- Using an emoji as a simple icon -->
                <span class="text-xl mr-3"></span>
                <span class="text-gray-600">
                  {{ parentCompany?.phone_number || ("search.phoneNotAvailable" | translate) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>

<!-- Display a message when no companies are found -->
<!-- <p *ngIf="companiess.length === 0" class="text-center text-gray-500">
  No companies found.
</p> -->

<!-- Search Container -->
<div *ngIf="!isLoggedIn" class="search-container">
  <div class="search-container !max-w-[1180px] !w-full !mx-2 !mx-auto">
    <div
      class="search-box bg-white shadow-lg rounded-lg p-8 max-w-full mx-auto"
    >
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-3 space-y-4 sm:space-y-0"
      >
        <!-- Search for Companies tab -->
        <div
          class="tab text-base sm:text-lg cursor-pointer"
          [class.active]="activeTab === 'companies'"
          (click)="activeTab = 'companies'"
          translate="search.companies"
        ></div>

        <!-- Advanced Search toggle (hidden on Contact tab) -->
        <div *ngIf="activeTab !== 'contact'" class="flex items-center">
          <label for="advancedSearch" class="flex items-center cursor-pointer">
            <span
              class="text-gray-500 mr-3 text-base sm:text-lg"
              translate="search.advancedSearch"
            ></span>
            <div class="relative">
              <input
                type="checkbox"
                id="advancedSearch"
                [(ngModel)]="advancedSearch"
                (change)="advancedSearchToggle()"
                class="sr-only"
              />
              <div
                class="toggle-line block w-14 h-7 bg-gray-300 rounded-full transition-all duration-300"
                [class.bg-[#085E5A]]="advancedSearch"
              ></div>
              <div
                class="toggle-dot absolute top-1 left-1 w-5 h-5 bg-white rounded-full transition-all duration-300"
                [class.translate-x-7]="advancedSearch"
              ></div>
            </div>
          </label>
        </div>

        <!-- Contact tab -->
        <div
          class="tab text-base sm:text-lg cursor-pointer"
          [class.active]="activeTab === 'contact'"
          (click)="activeTab = 'contact'"
          translate="search.aboutus"
        ></div>
      </div>

      <!-- Search Companies Section (Simple Search Form) -->
      <div class="py-6" *ngIf="activeTab === 'companies' && !advancedSearch">
        <h1 class="text-3xl font-bold" translate="search.companyNameOrUID"></h1>
        <p class="text-gray-500 text-lg" translate="search.whatsTheUID"></p>
        <div class="flex items-center mt-6 relative">
          <div class="relative w-full">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="onInputChange($event)"
              (keydown)="onKeyDown($event)"
              (focus)="onInputFocus()"
              (blur)="onInputBlur()"
              [placeholder]="'search.enterCompanyNameOrUID' | translate"
              class="search-input p-3 w-full text-lg rounded-lg border border-gray-300"
              autocomplete="off"
            />

            <!-- Autocomplete Dropdown -->
            <div
              *ngIf="
                showAutocompleteSuggestions &&
                autocompleteSuggestions.length > 0
              "
              class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto"
            >
              <div
                *ngFor="
                  let suggestion of autocompleteSuggestions;
                  let i = index
                "
                class="p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0"
                [class.bg-blue-50]="i === selectedSuggestionIndex"
                (mousedown)="selectSuggestion(suggestion)"
                (mouseenter)="selectedSuggestionIndex = i"
              >
                <div class="font-medium text-gray-900">
                  {{ suggestion.name }}
                </div>
                <div
                  class="text-sm text-gray-600"
                  *ngIf="suggestion.unique_identifier"
                >
                  {{'ID' | translate }}: {{ suggestion.unique_identifier }}
                </div>
              </div>
            </div>
          </div>

          <button
            (click)="onSearch()"
            class="search-button bg-[#085E5A] text-white px-6 py-3 ml-4 rounded-lg shadow-md hover:bg-[#064E4B] text-xl"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 21l-4.35-4.35m2.85-6.65a8 8 0 11-16 0 8 8 0 0116 0z"
              />
            </svg>
          </button>
        </div>
        <!-- ViewCompanysearch -->
        <div
        *ngIf="isAnotherSectionVisible"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 p-4"
      >
      <app-company-details-modal
          [company]="selectedCompany"
          [searchResults]="searchResults"
          [languageCodeToKey]="languageCodeToKey"
          [currentLanguage]="currentLanguage"
          (closeModal)="closeisCompanyDetailsVisible2()"
        ></app-company-details-modal>
      </div>
      
        <!-- Error Message -->
        <p *ngIf="errorMessage" class="text-red-500 mt-2">{{ errorMessage }}</p>

        <br />
        <!-- Default Companies Table
                <div class="table-container" *ngIf="!isSearchClicked ">
                    <div class="overflow-x-auto mt-0 !w-[1200px] !max-w-none mx-auto">
                        <table class="w-full text-sm text-left text-black dark:text-black">
                            <caption class="p-5 text-lg font-semibold text-left text-gray-900 bg-white">
                                {{ 'RESULTS_COUNT' | translate }}: {{ companiess.length }}
                            </caption>
                            <thead class="text-xs text-black uppercase bg-gray-50 dark:bg-gray-700 dark:text-black">
                                <tr>
                                    <th scope="col" class="px-6 py-3">{{ 'COMPANY_NAME' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'UID' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'LOCATION' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'legal_form' | translate }}</th>
                                    <th scope="col" class="px-6 py-3">{{ 'LEGAL_STATUS' | translate }}</th>
                                    <th scope="col" class="px-6 py-3 text-right">{{ 'ACTIONS' | translate }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let company of companiess"
                                    class="bg-white border-b dark:bg-white dark:border-gray-700">
                                    <td class="px-6 py-4 font-medium text-black whitespace-nowrap dark:text-black cursor-pointer hover:underline"
                                        (click)="viewCompanyDetailss(company.id)">
                                        {{ company.name }}
                                    </td>
                                    <td class="px-6 py-4">{{ company.unique_identifier }}</td>
                                    <td class="px-6 py-4">{{ company.headquarters }} {{ company.location }} {{
                                        company.country }}</td>
                                    <td class="px-6 py-4">
                                        {{ getLegalFormName(company.legal_information.legal_forms) }}
                                    </td>
                                    <td class="px-6 py-4">{{ getTranslatedStatus(company.legal_information.legal_status)
                                        }}</td>
                                    <td class="px-6 py-4 text-right">
                                        <a (click)="generatePDF(company.id)" download="report.pdf"
                                            class="font-medium text-blue-600 dark:text-blue-500 hover:underline">PDF</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br>
                
                </div>
                <div *ngIf="companiess.length === 0" class="text-center text-gray-500 mt-4">
                    {{ 'NO_COMPANIES_FOUND' | translate }}
                </div> -->
        <!-- Search Results Table () -->
        <div
          *ngIf="isSearchClicked && !showVerticalTable"
          class="table-container"
        >
          <div
            *ngIf="searchResults.length > 0"
            class="overflow-x-auto mt-0 !w-[1200px] !max-w-none mx-auto"
          >
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
              <table
                class="w-full text-sm text-left text-black dark:text-black rounded-lg"
              >
                <caption
                  class="p-5 text-lg font-semibold text-left text-gray-900 bg-white"
                >
                  {{
                    "RESULTS_COUNT" | translate
                  }}:
                  {{
                    searchTotalItems
                  }}
                </caption>
                <thead
                  class="text-xs text-black uppercase bg-gray-50 dark:bg-gray-700 dark:text-black"
                >
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      {{ "Logo" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "COMPANY_NAME" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "UID" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LOCATION" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "legal_form" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {{ "LEGAL_STATUS" | translate }}
                    </th>
                    <th scope="col" class="px-6 py-3 text-right">
                      {{ "ACTIONS" | translate }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let company of searchResults"
                    class="bg-white border-b dark:bg-white dark:border-gray-700"
                  >
                  <td class="p-3 " style="border: none">
                    <img src="{{ company.logo_url }}" class="h-20 w-20 " *ngIf="company?.logo_url"  />
                  </td>
                    <td
                      (click)="viewCompanyDetailss(company.id)"
                      class="px-6 py-4 font-medium tracking-widest text-black whitespace-nowrap dark:text-black cursor-pointer hover:underline"
                    >
                      {{ company.name }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.unique_identifier }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{ company.headquarters }}<br />
                      {{ company.zip_code }} {{ company.location }}<br />
                     
                        {{ ("COUNTRIES." + company.country.toUpperCase()) | translate }}

                      
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{
                        getLegalFormName(company.legal_information.legal_forms)
                      }}
                    </td>
                    <td class="px-6 py-4 tracking-widest">
                      {{
                        getTranslatedStatus(
                          company.legal_information.legal_status
                        )
                      }}
                    </td>
                    <td class="px-6 py-4 text-right">
                      <a
                        (click)="generatePDF(company.id)"
                        download="report.pdf"
                        class="font-medium text-blue-600 dark:text-blue-500 hover:underline cursor-pointer"
                        >PDF</a
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div
            *ngIf="searchResults.length === 0"
            class="text-center text-gray-500 mt-4"
          >
            {{ "No results found" | translate }}
          </div>
        </div>

        <!-- Search Results Pagination Controls -->
        <div
          class="flex flex-col sm:flex-row justify-center items-center mt-6 gap-4"
          *ngIf="(isSearchClicked || isSearchClickede) && searchTotalPages > 1"
        >
          <!-- Pagination Navigation -->
          <div class="flex items-center space-x-2">
            <!-- First Page -->
            <button
              (click)="goToSearchFirstPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'FIRST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Previous Page -->
            <button
              (click)="goToSearchPreviousPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'PREVIOUS_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Page Numbers -->
            <div class="flex space-x-1">
              <button
                *ngFor="let pageNum of searchPageNumbers"
                (click)="goToSearchPage(pageNum)"
                [class]="
                  searchCurrentPage === pageNum
                    ? 'px-3 py-2 text-sm bg-[#085E5A] text-white rounded-md'
                    : 'px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50'
                "
              >
                {{ pageNum }}
              </button>
            </div>

            <!-- Next Page -->
            <button
              (click)="goToSearchNextPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'NEXT_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>

            <!-- Last Page -->
            <button
              (click)="goToSearchLastPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'LAST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 5l7 7-7 7M5 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Search Results Summary (when no pagination needed) -->
        <div
          class="flex justify-between items-center mt-4"
          *ngIf="
            (isSearchClicked || isSearchClickede) &&
            searchTotalPages <= 1 &&
            searchResults.length > 0
          "
        >
          <div class="text-sm text-gray-600">
            {{ "TOTAL" | translate }}: {{ searchTotalItems }}
            {{ "ITEMS" | translate }}
          </div>
        </div>

        <!-- Compact Vertical Company Info View -->
        <div
            *ngIf="
              isSearchClicked && showVerticalTable && searchResults.length === 1"
            class="w-full bg-white rounded shadow-sm text-sm ml-4">
            <div
                class="border-b px-4 py-3 cursor-pointer"
                *ngFor="let company of searchResults"
                (click)="viewCompanyDetailss(company.id)"
              >
                <div class="flex items-center space-x-3">
                          
                  <div class="h-14 w-14 rounded-lg overflow-hidden bg-gray-100 border border-gray-200 flex-shrink-0">
                    <img 
                      [src]="searchResults[0].logo_url" 
                      [alt]="searchResults[0].name + ' logo'"
                      class="h-full w-full object-cover"
                      *ngIf="searchResults[0]?.logo_url"
                    />
                    <div  
                      class="h-full w-full flex items-center justify-center text-blue-700 text-xl font-medium"
                      *ngIf="!searchResults[0]?.logo_url"
                    >
                      {{ searchResults[0].name?.charAt(0)?.toUpperCase() }}
                    </div>
                  </div>
                  <div>
                    <h1
                        class="text-xl text-blue-700 font-medium hover:underline cursor-pointer text-right"
                      >
                        {{ company.name }}
                    </h1>
                    <span class="text-sm text-gray-500 mt-1">
                      {{ searchResults[0].unique_identifier }}
                    </span>
                  </div>
                </div>
              </div>
             

            <div class="divide-y">
              <div class="flex justify-between px-4 py-2 bg-gray-50">
                <div class="text-gray-600 font-medium">
                  {{ "ADDRESS" | translate }}
                </div>
                <div class="text-gray-800 text-right">
                  {{ searchResults[0].headquarters }}
                  {{ searchResults[0].location }}
                </div>
              </div>

              <div class="flex justify-between px-4 py-2">
                <div class="text-gray-600 font-medium">
                  {{ "PROJECT_ACTIVITY" | translate }}
                </div>
                
                <!-- Desktop version with tooltip -->
                <div class="hidden tablet:block">
                  <div
                    class="text-gray-800 text-right"
                    [matTooltip]="searchResults[0].activity?.details"
                    matTooltipPosition="above"
                    matTooltipClass="custom-tooltip"
                  >
                    {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                    {{ searchResults[0].activity?.details | truncate: 30 }}
                  </div>
                </div>
                
                <!-- Mobile version with view more button -->
                <div class="block tablet:hidden text-right">
                  <div class="text-gray-800">
                    {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                    {{ searchResults[0].activity?.details | truncate: 20 }}
                  </div>
                  <button 
                    *ngIf="searchResults[0].activity?.details && (searchResults[0].activity?.details).length > 20"
                    (click)="openActivityDetailsModal()"
                    class="text-blue-600 text-xs mt-1 underline hover:text-blue-800"
                  >
                    {{ "VIEW_MORE" | translate }}
                  </button>
                </div>
              </div>
              
              <!-- Activity Details Modal -->
              <div
                *ngIf="showActivityDetailsModal"
                class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
                (click)="closeActivityDetailsModal()"
              >
                <div
                  class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-hidden"
                  (click)="$event.stopPropagation()"
                >
                  <!-- Header -->
                  <div class="bg-[#085E5A] px-4 py-3 text-white">
                    <div class="flex justify-between items-center">
                      <h3 class="text-lg font-semibold">{{ "PROJECT_ACTIVITY" | translate }}</h3>
                      <button 
                        (click)="closeActivityDetailsModal()"
                        class="text-white hover:text-gray-200"
                      >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Content -->
                  <div class="p-4 overflow-y-auto max-h-[60vh]">
                    <div class="mb-3" *ngIf="searchResults[0].activity?.project_name">
                      <h4 class="font-medium text-gray-800 mb-1">{{ "PROJECT_NAME" | translate }}</h4>
                      <p class="text-gray-700">{{ searchResults[0].activity?.project_name }}</p>
                      
                    </div>
                    
                    <div *ngIf="searchResults[0].activity?.details">
                      <h4 class="font-medium text-gray-800 mb-1">{{ "DETAILS" | translate }}</h4>
                      <p class="text-gray-700 leading-relaxed">{{ searchResults[0].activity?.details }}</p>
                    </div>
                  </div>
                  
                  <!-- Footer -->
                  <div class="px-4 py-3 border-t border-gray-200">
                    <button
                      (click)="closeActivityDetailsModal()"
                      class="w-full bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064540] transition-colors"
                    >
                      {{ "CLOSE" | translate }}
                    </button>
                  </div>
                </div>
              </div>
              <div class="flex justify-between px-4 py-2 bg-gray-50">
                <div class="text-gray-600 font-medium">
                  {{ "COUNTRY" | translate }}
                </div>
                <div class="text-gray-800 text-right">
                  <!-- {{ searchResults[0].country }} -->
                {{ ("COUNTRIES." + searchResults[0].country.toUpperCase()) | translate }}

                </div>
              </div>
              <div class="flex justify-between px-4 py-2">
                <div class="text-gray-600 font-medium">
                  {{ "LEGAL_FORM" | translate }}
                </div>
                <div class="text-gray-800 text-right">
                  {{
                    getLegalFormName(
                      searchResults[0].legal_information.legal_forms
                    )
                  }}
                </div>
              </div>
              <div class="flex justify-between px-4 py-2 bg-gray-50">
                <div class="text-gray-600 font-medium">
                  {{ "STATUS" | translate }}
                </div>
                <div class="text-gray-800 text-right">
                  {{
                    getTranslatedStatus(
                      searchResults[0].legal_information.legal_status
                    )
                  }}
                </div>
              </div>

                <!-- <div class="flex justify-between px-4 py-2">
                  <div class="text-gray-600 font-medium">
                    {{ "UID" | translate }}
                  </div>
                  <div class="text-gray-800 text-right">
                    {{ searchResults[0].unique_identifier }}
                  </div>
                </div> -->

              <div class="flex justify-between px-4 py-2 bg-gray-50">
                <div class="text-gray-600 font-medium">
                  {{ "ACTIONS" | translate }}
                </div>
                <div
                  class="space-x-2 text-right"
                  *ngFor="let company of searchResults"
                >
                  <a
                    (click)="generatePDF(company.id)"
                    class="text-blue-600 hover:underline cursor-pointer"
                    >{{ "pdf" | translate }}</a
                  >
                </div>
              </div>
            </div>
          </div>
      </div>

      <!-- Advanced Search Section -->
       <!-- toedit1 -->
      <div class="py-6" *ngIf="activeTab === 'companies' && advancedSearch">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-6">
          <div class="col-span-2">
            <label
              class="block text-lg font-medium text-gray-700"
              translate="search.companyNameOrUID"
            ></label>
            <div class="relative">
              <!-- toedit4 -->
              <input
                type="text"
                [(ngModel)]="searchQuery"
                (input)="onAdvancedInputChange($event)"
                (keydown)="onAdvancedKeyDown($event)"
                (focus)="onAdvancedInputFocus()"
                (blur)="onAdvancedInputBlur()"
                [placeholder]="'search.companyNameOrUID' | translate"
                class="advanced-search-input p-3 w-full text-lg rounded-lg border border-gray-300"
                autocomplete="off"
              />

              <div
                *ngIf="
                  showAdvancedAutocompleteSuggestions &&
                  advancedAutocompleteSuggestions.length > 0
                "
                class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto"
              >
                <div
                  *ngFor="
                    let suggestion of advancedAutocompleteSuggestions;
                    let i = index
                  "
                  class="p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-100 last:border-b-0"
                  [class.bg-blue-50]="i === selectedAdvancedSuggestionIndex"
                  (mousedown)="selectAdvancedSuggestion(suggestion)"
                  (mouseenter)="selectedAdvancedSuggestionIndex = i"
                >
                  <div class="font-medium text-gray-900">
                    {{ suggestion.name }}
                  </div>
                  <div
                    class="text-sm text-gray-600"
                    *ngIf="suggestion.unique_identifier"
                  >
                    {{'ID' | translate }}: {{ suggestion.unique_identifier }}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Error Message -->
          <p *ngIf="errorMessage" class="text-red-500 mt-2">
            {{ errorMessage }}
          </p>

          <div class="col-span-2">
            <label
              class="block text-lg font-medium text-gray-700"
              translate="search.location"
            ></label>
            <ng-select
              class="advanced-search-input p-3 w-full text-lg rounded-lg border border-gray-300 bg-gray-100 ng-placeholder-light"
              [items]="filteredRegions"
              bindLabel="displayLabel"
              [multiple]="true"
              [(ngModel)]="selectedRegions"
              [placeholder]="
                currentSearchTerm && currentSearchTerm.length > 0
                  ? ''
                  : ('search.select.region' | translate)
              "
              (search)="onRegionSearch($event)"
              [addTag]="customAddTag"
              [addTagText]="'search.add.region' | translate"
              [notFoundText]="
                currentSearchTerm && currentSearchTerm.length > 0
                  ? ('no.items.found' | translate)
                  : ''
              "
              (add)="onCustomRegionAdd($event)"
            >
            </ng-select>
          </div>

          <div class="flex flex-col">
            <!-- Canton Selection 
                        <div class="form-group w-full md:w-1/2 lg:w-full">
                            <label class="form-label">{{ 'Canton' | translate }}</label>
                            <mat-form-field appearance="outline" class="custom-selectt w-full">
                                <mat-select [(ngModel)]="selectedKantons" multiple panelClass="kanton-dropdown"
                                    [placeholder]="'SELECT_CANTON' | translate">
                                    <mat-option *ngFor="let kanton of kantons" [value]="kanton.code">
                                        <div class="kanton-item">
                                            <span class="kanton-code">{{ kanton.code }}</span>
                                            <span class="kanton-name">{{ kanton.name }}</span>
                                        </div>
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <br>-->
            <!-- Legal Form Selection -->
            <!-- Legal Form Selection -->
            <div class="form-group w-full md:w-1/2 lg:w-full">
              <label class="form-label">{{ "Legal Form" | translate }}</label>
              <div class="relative w-full">
                <select
                  [(ngModel)]="legal_forms"
                  class="appearance-none w-full p-2 border-b border-gray-300 text-base text-gray-400 focus:ring-0 focus:border-[#085E5A]"
                >
                  <option value="" disabled selected class="text-gray-400">
                    {{ "Select a legal form" | translate }}
                  </option>
                  <option
                    *ngFor="let form of legalFormsList"
                    [value]="form.value"
                  >
                    {{ form.key | translate }}
                  </option>
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <div class="col-span-2 flex justify-center space-x-4">
            <button
              (click)="resetFields()"
              class="reset-button bg-gray-500 text-white px-6 py-3 rounded-lg shadow-md hover:bg-gray-600 text-xl flex items-center gap-2"
            >
              {{ "search.reset" | translate }}
            </button>

            <button
              (click)="onSsearch()"
              class="search-button bg-[#085E5A] text-white px-6 py-3 rounded-lg shadow-md hover:bg-[#064A47] text-xl flex items-center gap-2"
            >
              {{ "search.search" | translate }}
            </button>
          </div>
        </div>
        <br />


        <div
          *ngIf="isSearchClickede && !showVerticalTable"
          class=""
        >
        
          <div
            *ngIf="searchResults.length > 0 && !showVerticalTable"
           
          >
          <app-search-results-grid
            [searchResults]="searchResults"
            [searchTotalItems]="searchTotalItems"
            [getLegalFormName]="getLegalFormName.bind(this)"
            [getTranslatedStatus]="getTranslatedStatus.bind(this)"
            (companySelected)="viewCompanyDetailss($event)"
            (pdfGenerated)="generatePDF($event)">
          </app-search-results-grid>
          </div>
          <!-- If no results, display a message -->
          <div
            *ngIf="searchResults.length === 0 && !showVerticalTable"
            class="text-center text-gray-500 mt-4"
          >
            {{ "NO_RESULTS" | translate }}
          </div>

          
        </div>

        <!-- Search Results Pagination Controls -->
        <div
          class="flex flex-col sm:flex-row justify-center items-center mt-6 gap-4"
          *ngIf="(isSearchClicked || isSearchClickede) && searchTotalPages > 1"
        >
          <!-- Pagination Navigation -->
          <div class="flex items-center space-x-2">
            <!-- First Page -->
            <button
              (click)="goToSearchFirstPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'FIRST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 19l-7-7 7-7m8 14l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Previous Page -->
            <button
              (click)="goToSearchPreviousPage()"
              [disabled]="!searchHasPrevious"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'PREVIOUS_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- Page Numbers -->
            <div class="flex space-x-1">
              <button
                *ngFor="let pageNum of searchPageNumbers"
                (click)="goToSearchPage(pageNum)"
                [class]="
                  searchCurrentPage === pageNum
                    ? 'px-3 py-2 text-sm bg-[#085E5A] text-white rounded-md'
                    : 'px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50'
                "
              >
                {{ pageNum }}
              </button>
            </div>

            <!-- Next Page -->
            <button
              (click)="goToSearchNextPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'NEXT_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>

            <!-- Last Page -->
            <button
              (click)="goToSearchLastPage()"
              [disabled]="!searchHasNext"
              class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              [title]="'LAST_PAGE' | translate"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 5l7 7-7 7M5 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Search Results Summary (when no pagination needed) -->
        <div
          class="flex justify-between items-center mt-4"
          *ngIf="
            (isSearchClicked || isSearchClickede) &&
            searchTotalPages <= 1 &&
            searchResults.length > 0
          "
        >
          <div class="text-sm text-gray-600">
            {{ "TOTAL" | translate }}: {{ searchTotalItems }}
            {{ "ITEMS" | translate }}
          </div>
        </div>
        <!-- ViewCompanysearch -->
        <div
          *ngIf="isAnotherSectionVisible"
          class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"
        >
        <app-company-details-modal
          [company]="selectedCompany"
          [searchResults]="searchResults"
          [languageCodeToKey]="languageCodeToKey"
          [currentLanguage]="currentLanguage"
          (closeModal)="closeisCompanyDetailsVisible2()"
        ></app-company-details-modal>
        </div>

        <!-- Compact Vertical Company Info View -->
        <div
          *ngIf="
            isSearchClickede && showVerticalTable && searchResults.length === 1
          "
          class="w-full bg-white rounded shadow-sm text-sm ml-4"
        >
          <div
            class="border-b px-4 py-3"
            *ngFor="let company of searchResults"
            (click)="viewCompanyDetailss(company.id)"
          >
            <!-- Top Row: Name + File Icon -->
            <!-- <div class="flex justify-between items-center">
              <h1
                class="text-2xl text-blue-600 hover:underline cursor-pointer text-right"
              >
                {{ company.name }}
              </h1>
            </div> -->
            <div class="flex items-center space-x-3">
                          
              <div class="h-14 w-14 rounded-lg overflow-hidden bg-gray-100 border border-gray-200 flex-shrink-0">
                <img 
                  [src]="searchResults[0].logo_url" 
                  [alt]="searchResults[0].name + ' logo'"
                  class="h-full w-full object-cover"
                  *ngIf="searchResults[0]?.logo_url"
                />
                <div  
                  class="h-full w-full flex items-center justify-center text-blue-700 text-xl font-medium"
                  *ngIf="!searchResults[0]?.logo_url"
                >
                  {{ searchResults[0].name?.charAt(0)?.toUpperCase() }}
                </div>
              </div>
              <div>
                <h1
                    class="text-xl text-blue-700 font-medium hover:underline cursor-pointer"
                  >
                    {{ company.name }}
                </h1>
                <span class="text-sm text-gray-500 mt-1">
                  {{ searchResults[0].unique_identifier }}
                </span>
              </div>
            </div>
          </div>

          <div class="divide-y">
            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ADDRESS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].headquarters }}
                {{ searchResults[0].location }}
              </div>
            </div>

            <!-- <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "BRANCH_LOCATION" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ getBranchLocationNames(searchResults[0].branch_locations) }}
              </div>
            </div> -->

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "PROJECT_ACTIVITY" | translate }}
              </div>
              
              <!-- Desktop version with tooltip -->
              <div class="hidden tablet:block">
                <div
                  class="text-gray-800 text-right"
                  [matTooltip]="searchResults[0].activity?.details"
                  matTooltipPosition="above"
                  matTooltipClass="custom-tooltip"
                >
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 30 }}
                </div>
              </div>
              
              <!-- Mobile version with view more button -->
              <div class="block tablet:hidden text-right">
                <div class="text-gray-800">
                  {{ searchResults[0].activity?.project_name }} {{ searchResults[0].activity.project_name ? '-' : '' }}
                  {{ searchResults[0].activity?.details | truncate: 20 }}
                </div>
                <button 
                  *ngIf="searchResults[0].activity?.details && (searchResults[0].activity?.details).length > 20"
                  (click)="openActivityDetailsModal()"
                  class="text-blue-600 text-xs mt-1 underline hover:text-blue-800"
                >
                  {{ "VIEW_MORE" | translate }}
                </button>
              </div>
            </div>
            
            <!-- Activity Details Modal -->
            <div
              *ngIf="showActivityDetailsModal"
              class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
              (click)="closeActivityDetailsModal()"
            >
              <div
                class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-hidden"
                (click)="$event.stopPropagation()"
              >
                <!-- Header -->
                <div class="bg-[#085E5A] px-4 py-3 text-white">
                  <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">{{ "PROJECT_ACTIVITY" | translate }}</h3>
                    <button 
                      (click)="closeActivityDetailsModal()"
                      class="text-white hover:text-gray-200"
                    >
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Content -->
                <div class="p-4 overflow-y-auto max-h-[60vh]">
                  <div class="mb-3" *ngIf="searchResults[0].activity?.project_name">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "PROJECT_NAME" | translate }}</h4>
                    <p class="text-gray-700">{{ searchResults[0].activity?.project_name }}</p>
                  </div>
                  
                  <div *ngIf="searchResults[0].activity?.details">
                    <h4 class="font-medium text-gray-800 mb-1">{{ "DETAILS" | translate }}</h4>
                    <p class="text-gray-700 leading-relaxed">{{ searchResults[0].activity?.details }}</p>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="px-4 py-3 border-t border-gray-200">
                  <button
                    (click)="closeActivityDetailsModal()"
                    class="w-full bg-[#085E5A] text-white py-2 px-4 rounded-lg hover:bg-[#064540] transition-colors"
                  >
                    {{ "CLOSE" | translate }}
                  </button>
                </div>
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "COUNTRY" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                <!-- {{ searchResults[0].country }} -->

                {{ ("COUNTRIES." + searchResults[0].country.toUpperCase()) | translate }}

              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "LEGAL_FORM" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getLegalFormName(
                    searchResults[0].legal_information.legal_forms
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "STATUS" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{
                  getTranslatedStatus(
                    searchResults[0].legal_information.legal_status
                  )
                }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2">
              <div class="text-gray-600 font-medium">
                {{ "UID" | translate }}
              </div>
              <div class="text-gray-800 text-right">
                {{ searchResults[0].unique_identifier }}
              </div>
            </div>

            <div class="flex justify-between px-4 py-2 bg-gray-50">
              <div class="text-gray-600 font-medium">
                {{ "ACTIONS" | translate }}
              </div>
              <div
                class="space-x-2 text-right"
                *ngFor="let company of searchResults"
              >
                <a
                  (click)="generatePDF(company.id)"
                  class="text-blue-600 hover:underline cursor-pointer"
                  >{{ "pdf" | translate }}</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Contact Section -->
      
      <div class="py-6 px-4 sm:px-6" *ngIf="activeTab === 'contact'">
       
        <div class="grid gap-8 md:grid-cols-2">
          <!-- Address and Opening Hours Section -->
          <div>
            <!-- Address Block -->
            <div class="mb-6">
              <h1 class="text-lg font-semibold text-gray-800 mb-2">
                {{ "search.address" | translate }}
              </h1>
              <p class="text-gray-600">
                {{ parentCompany?.address || ("search.addressNotAvailable" | translate) }}
              </p>
              <p class="text-gray-600">
                {{ parentCompany?.zip_code || ("search.zipNotAvailable" | translate) }}
                {{ parentCompany?.city || ("search.cityNotAvailable" | translate) }}
              </p>
            </div>
      
            <!-- Opening Hours Block -->
            <div>
              <h1 class="text-lg font-semibold text-gray-800 mb-2" translate="search.openingHours"></h1>
              <p class="text-gray-600">
                {{
                  workDaysMap[parentCompany?.work_days]
                    ? (workDaysMap[parentCompany?.work_days] | translate)
                    : parentCompany?.work_days || ("search.workdaysNotAvailable" | translate)
                }}
              </p>
              <p class="text-gray-600">
                {{ parentCompany?.work_hours || ("search.workhourNotAvailable" | translate) }}
              </p>
            </div>
          </div>
      
          <!-- Contact Details Section -->
          <div>
            <h1 class="text-lg font-semibold text-gray-800 mb-2" translate="search.contact"></h1>
            <!-- 
              Using a flex container with 'flex-col' to stack contact items vertically.
              'space-y-3' adds vertical spacing between the items.
            -->
            <div class="flex flex-col space-y-3">
              <!-- Email Contact Item -->
              <div class="flex items-center">
                <img src="/assets/2709.svg" alt="email" class="h-6 w-6 mr-3 text-gray-500" />
                <span class="text-gray-600">
                  {{ parentCompany?.email || ("search.emailNotAvailable" | translate) }}
                </span>
              </div>
      
              <!-- Phone Contact Item -->
              <div class="flex items-center">
                <!-- Using an emoji as a simple icon -->
                <span class="text-xl mr-3"></span>
                <span class="text-gray-600">
                  {{ parentCompany?.phone_number || ("search.phoneNotAvailable" | translate) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
  
</div>

<br />


<!-- delete Modal -->
<div
  *ngIf="isModalOpen"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
>
  <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
    <!-- Modal Header -->
    <h2 class="text-xl font-semibold text-center text-gray-800">
      {{ "areYouSureDeleteCompany" | translate }}
    </h2>

    <!-- Company Details -->
    <div class="mt-4 border-t pt-4">
      <div class="flex items-center gap-3">
        <div class="bg-gray-200 p-3 rounded-full">
          <svg
            class="w-6 h-6 text-gray-900 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12.013 6.175 7.006 9.369l5.007 3.194-5.007 3.193L2 12.545l5.006-3.193L2 6.175l5.006-3.194 5.007 3.194ZM6.981 17.806l5.006-3.193 5.006 3.193L11.987 21l-5.006-3.194Z"
            />
            <path
              d="m12.013 12.545 5.006-3.194-5.006-3.176 4.98-3.194L22 6.175l-5.007 3.194L22 12.562l-5.007 3.194-4.98-3.211Z"
            />
          </svg>
        </div>
        <div>
          <p class="text-sm font-semibold text-gray-800">{{ companyName }}</p>
        </div>
      </div>
    </div>

    <!-- Description -->
    <p class="mt-4 text-sm text-gray-600 leading-relaxed">
      {{ "thisActionWillMarkAsDeleted" | translate }}
    </p>
    <div
      *ngIf="errorMessage55"
      class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg"
    >
      <p>{{ errorMessage55 }}</p>
    </div>
    <!-- Actions -->
    <div class="mt-6 flex justify-between">
      <button
        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-200"
        (click)="requestDeletion(companyID)"
      >
        {{ "requestDeletion" | translate }}
      </button>

      <button
        (click)="closeModal()"
        class="px-4 py-2 border rounded-lg hover:bg-gray-100 transition duration-200"
      >
        {{ "cancel" | translate }}
      </button>
    </div>
  </div>
</div>
